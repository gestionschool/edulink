import{m as x,p as D,w as E,c,a as l,b as e,x as T,k as j,j as f,J as B,O as I,F as k,h,f as J,t as a,o,n as R}from"./index-BVVU7ImF.js";import{u as q}from"./usePresences-CCaBaJjc.js";import{u as G}from"./useClasses-6cjNtIyF.js";import{u as K}from"./useCours-WlUt9X8U.js";import{u as Q}from"./useStudents-D51OTvSI.js";const W={class:"space-y-6"},X={class:"grid gap-3 md:grid-cols-5"},Y=["value"],Z=["value"],ee={key:0,class:"rounded-xl border border-slate-200 p-4 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},te={key:1,class:"rounded-xl border border-slate-200 p-4 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},se={key:2,class:"md:hidden divide-y divide-slate-100 dark:divide-slate-800 rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},re={class:"flex items-center justify-between"},ae={class:"text-sm font-medium"},le={class:"mt-1 text-xs text-slate-500 dark:text-slate-400"},oe={class:"mt-2 flex justify-end"},de=["onClick"],ne={key:3,class:"hidden md:block overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},ie={class:"overflow-x-auto"},ue={class:"min-w-full text-left text-sm"},ce={class:"px-4 py-3"},be={class:"px-4 py-3"},me={class:"px-4 py-3"},ve={class:"px-4 py-3"},pe={class:"px-4 py-3"},xe={class:"px-4 py-3"},fe={class:"flex justify-end"},ge=["onClick"],ke={class:"border-t border-slate-100 px-4 py-3 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},Le={__name:"PresencesList",setup(he){const g=q(),y=G(),w=K(),L=Q(),S=new Date().toISOString().slice(0,10),b=x(S),m=x(S),d=x(""),v=x(""),p=x("");D(async()=>{await Promise.all([y.fetch(),w.fetch(),L.fetch()]),await _()}),E([b,m,d,v,p],_);function _(){const r={...b.value?{date_gte:b.value}:{},...m.value?{date_lte:m.value}:{},...d.value?{classeId:Number(d.value)}:{},...v.value?{coursId:Number(v.value)}:{},...p.value?{statut:p.value}:{},_sort:"date",_order:"desc"};return g.fetch(r)}const U=c(()=>y.items||[]),A=c(()=>{const r=w.items||[];return d.value?r.filter(s=>Number(s.classeId)===Number(d.value)):r}),z=c(()=>y.byId||{}),M=c(()=>w.byId||{}),F=c(()=>L.byId||{}),i=c(()=>(g.items||[]).map(r=>{const s=z.value[r.classeId],t=M.value[r.coursId],n=F.value[r.eleveId];return{...r,classeLabel:s?s.libelle||s.label||s.code:"",coursLabel:t?`${t.matiere} — ${t.intitule||t.code}`:"",eleveName:n?n.nom||n.name:`#${r.eleveId}`}}));function V(r){const s="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium";return r==="P"?`${s} bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-200`:r==="A"?`${s} bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-200`:r==="R"?`${s} bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-200`:`${s} bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200`}const $=r=>r==="P"?"Présent":r==="A"?"Absent":r==="R"?"Retard":"—";async function N(r){confirm("Supprimer cette présence ?")&&(await g.removeOne(r),await _())}function H(){window.print()}function O(){const r=["id","date","classe","cours","eleve","statut"],s=i.value.map(u=>[u.id,u.date,`"${u.classeLabel}"`,`"${u.coursLabel}"`,`"${u.eleveName}"`,u.statut].join(",")),t=[r.join(","),...s].join(`
`),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),P=URL.createObjectURL(n),C=document.createElement("a");C.href=P,C.download="presences.csv",C.click(),URL.revokeObjectURL(P)}return(r,s)=>(o(),l("div",W,[e("div",{class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},[s[7]||(s[7]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Présences — Liste"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Filtre par période, classe, cours et statut. Export CSV disponible. ")],-1)),e("div",{class:"flex flex-wrap gap-2"},[e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-medium shadow-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900",onClick:H},[...s[5]||(s[5]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 9V2h12v7h2a2 2 0 0 1 2 2v6h-4v5H8v-5H4v-6a2 2 0 0 1 2-2h0zm2-5v5h8V4H8zm2 13v3h4v-3h-4z"})],-1),j(" Imprimer ",-1)])]),e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900",onClick:O},[...s[6]||(s[6]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M5 20h14v-2H5v2zM12 2l4 4h-3v6h-2V6H8l4-4z"})],-1),j(" Export CSV ",-1)])])])]),e("div",X,[f(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>b.value=t),type:"date",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[B,b.value]]),f(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),type:"date",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[B,m.value]]),f(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>d.value=t),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[s[8]||(s[8]=e("option",{value:""},"— Classe —",-1)),(o(!0),l(k,null,h(U.value,t=>(o(),l("option",{key:t.id,value:t.id},a(t.libelle||t.label||t.code),9,Y))),128))],512),[[I,d.value,void 0,{number:!0}]]),f(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>v.value=t),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[s[9]||(s[9]=e("option",{value:""},"— Cours —",-1)),(o(!0),l(k,null,h(A.value,t=>(o(),l("option",{key:t.id,value:t.id},a(t.matiere)+" — "+a(t.intitule||t.code),9,Z))),128))],512),[[I,v.value,void 0,{number:!0}]]),f(e("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>p.value=t),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[...s[10]||(s[10]=[e("option",{value:""},"Tous statuts",-1),e("option",{value:"P"},"Présent",-1),e("option",{value:"A"},"Absent",-1),e("option",{value:"R"},"Retard",-1)])],512),[[I,p.value]])]),J(g).loading?(o(),l("div",ee," Chargement… ")):i.value.length===0?(o(),l("div",te," Aucune présence sur cette période. ")):(o(),l("div",se,[(o(!0),l(k,null,h(i.value,t=>(o(),l("div",{key:t.id,class:"p-3"},[e("div",re,[e("div",ae,a(t.eleveName),1),e("span",{class:R(V(t.statut))},a($(t.statut)),3)]),e("div",le,a(t.date)+" — "+a(t.classeLabel)+" — "+a(t.coursLabel),1),e("div",oe,[e("button",{class:"rounded-md border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:n=>N(t.id)}," Supprimer ",8,de)])]))),128))])),i.value.length?(o(),l("div",ne,[e("div",ie,[e("table",ue,[s[11]||(s[11]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Date"),e("th",{class:"px-4 py-3 font-medium"},"Classe"),e("th",{class:"px-4 py-3 font-medium"},"Cours"),e("th",{class:"px-4 py-3 font-medium"},"Élève"),e("th",{class:"px-4 py-3 font-medium"},"Statut"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(o(!0),l(k,null,h(i.value,t=>(o(),l("tr",{key:t.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",ce,a(t.date),1),e("td",be,a(t.classeLabel),1),e("td",me,a(t.coursLabel),1),e("td",ve,a(t.eleveName),1),e("td",pe,[e("span",{class:R(V(t.statut))},a($(t.statut)),3)]),e("td",xe,[e("div",fe,[e("button",{class:"rounded-md border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:n=>N(t.id)}," Supprimer ",8,ge)])])]))),128))])]),e("div",ke,a(i.value.length)+" enregistrements ",1)])])):T("",!0)]))}};export{Le as default};
