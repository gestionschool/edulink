import{u as H,c as i,m as c,p as K,a as o,b as l,x as k,d as Q,i as W,n as X,k as j,t as u,j as m,O as h,F as V,h as C,e as U,R as L,o as r,z as Y,J as O}from"./index-BVVU7ImF.js";import{u as Z,_ as ee}from"./useSeances-B606Wp1L.js";import{M as te}from"./Modal-sd0sgwys.js";import{u as le}from"./useClasses-6cjNtIyF.js";import{u as se}from"./useCours-WlUt9X8U.js";import{u as ae}from"./useTeachers-Cow4PRiH.js";import{u as re}from"./usePeriodes-DPgYpSBx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"space-y-6"},de={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ue={class:"flex flex-wrap items-center gap-2"},ne={key:0,class:"opacity-75"},ie={key:0,class:"rounded-xl border border-amber-200 bg-amber-50 p-4 text-sm text-amber-800 dark:border-amber-900/50 dark:bg-amber-950/40 dark:text-amber-200"},me={key:1,class:"grid gap-3 md:grid-cols-2"},be=["value"],ve=["value"],pe={class:"text-base font-semibold"},ce={class:"grid gap-3 md:grid-cols-2"},xe=["value"],fe={class:"grid gap-3 md:grid-cols-2"},ke={class:"grid gap-3 md:grid-cols-2"},ge=["value"],ye=["value"],we={key:0,class:"text-sm text-red-600 dark:text-red-400"},Ie=["disabled"],he=["disabled"],Ve=["disabled"],qe={__name:"EmploisMes",setup(Ce){const N=H(),b=Z(),$=le(),S=se(),q=ae(),A=re(),T=["Lun","Mar","Mer","Jeu","Ven","Sam"],x=i(()=>N.user?.teacherId??1),g=i(()=>{const s=x.value;return s?(q.items||[]).find(e=>e.id===s):null}),P=i(()=>g.value?g.value.prenom?`${g.value.prenom} ${g.value.nom}`:g.value.nom:N.user?.name??"—"),B=i(()=>!!x.value),y=i(()=>N.role===L.ADMIN_GENERALE||N.role===L.ADMIN_ECOLE),w=c(""),M=c(""),v=c(!1),p=c(!1),f=c(null),n=c(null),a=c({jour:1,start:"08:00",end:"09:00",classeId:"",coursId:"",teacherId:"",salle:""});K(async()=>{await Promise.all([q.fetch(),$.fetch(),S.fetch(),A.fetch?.()]);try{await b.fetch()}catch(s){console.warn("[seances] manquant (dev) :",s?.message)}});const E=i(()=>$.items||[]),_=i(()=>A.items||[]),z=i(()=>(S.items||[]).filter(s=>!a.value.classeId||Number(s.classeId)===Number(a.value.classeId))),F=i(()=>{let s=b.items||[];const e=Number(x.value||0);if(e&&(s=s.filter(d=>Number(d.teacherId)===e)),w.value&&(s=s.filter(d=>Number(d.classeId)===Number(w.value))),M.value){const d=new Set((S.items||[]).filter(I=>Number(I.periodeId)===Number(M.value)).map(I=>I.id));s=s.filter(I=>d.has(I.coursId))}const t=Object.fromEntries((S.items||[]).map(d=>[d.id,d]));return s.map(d=>({...d,...t[d.coursId]||{}}))});function J(){y.value&&(f.value=null,n.value=null,a.value={jour:1,start:"08:00",end:"09:00",classeId:w.value||(E.value[0]?.id??""),coursId:"",teacherId:x.value||"",salle:""},v.value=!0)}function R(s){y.value&&(f.value=null,n.value=s.id,a.value={jour:s.jour,start:s.start,end:s.end,classeId:s.classeId,coursId:s.coursId,teacherId:s.teacherId,salle:s.salle||""},v.value=!0)}async function D(){f.value=null,p.value=!0;try{n.value?await b.updateOne(n.value,a.value):await b.createOne(a.value),await b.fetch(),v.value=!1}catch(s){f.value=s?.message||"Erreur"}finally{p.value=!1}}async function G(){if(n.value&&confirm("Supprimer cette séance ?")){p.value=!0;try{await b.removeOne(n.value),await b.fetch(),v.value=!1}finally{p.value=!1}}}return(s,e)=>(r(),o("div",oe,[l("div",de,[e[13]||(e[13]=l("div",null,[l("h1",{class:"text-xl font-semibold"},"Mes horaires"),l("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Planning hebdomadaire de vos séances. ")],-1)),l("div",ue,[l("span",{class:X(["rounded-md px-2.5 py-1 text-xs border",B.value?"border-slate-200 bg-slate-50 dark:border-slate-700 dark:bg-slate-900":"border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-900/50 dark:bg-amber-950/40 dark:text-amber-200"])},[j(" Prof : "+u(P.value)+" ",1),B.value?k("",!0):(r(),o("span",ne,"(non lié)"))],2),l("button",{class:"rounded-md border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900",onClick:e[0]||(e[0]=t=>s.window.print())}," Imprimer ")])]),x.value?k("",!0):(r(),o("div",ie,[...e[14]||(e[14]=[j(" Votre compte n’est pas lié à un professeur (",-1),l("code",null,"user.teacherId",-1),j(" manquant). Demandez à l’admin de lier votre compte. ",-1)])])),x.value?(r(),o("div",me,[m(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[e[15]||(e[15]=l("option",{value:""},"— Toutes classes —",-1)),(r(!0),o(V,null,C(E.value,t=>(r(),o("option",{key:t.id,value:t.id},u(t.libelle||t.label||t.code),9,be))),128))],512),[[h,w.value,void 0,{number:!0}]]),m(l("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>M.value=t),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[e[16]||(e[16]=l("option",{value:""},"— Période (optionnel) —",-1)),(r(!0),o(V,null,C(_.value,t=>(r(),o("option",{key:t.id,value:t.id},u(t.label),9,ve))),128))],512),[[h,M.value,void 0,{number:!0}]])])):k("",!0),Q(ee,{sessions:F.value,onCreate:e[3]||(e[3]=t=>y.value?J():null),onEdit:e[4]||(e[4]=t=>y.value?R:null)},null,8,["sessions"]),y.value?(r(),W(te,{key:2,modelValue:v.value,"onUpdate:modelValue":e[12]||(e[12]=t=>v.value=t)},{title:U(()=>[l("h3",pe,u(n.value?"Modifier la séance":"Ajouter une séance"),1)]),actions:U(()=>[l("button",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900",onClick:e[11]||(e[11]=t=>v.value=!1),disabled:p.value},"Annuler",8,Ie),l("button",{class:"inline-flex items-center rounded-md border border-violet-200 bg-violet-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-violet-700 disabled:opacity-60 dark:border-violet-900",onClick:D,disabled:p.value},u(n.value?"Mettre à jour":"Créer"),9,he),n.value?(r(),o("button",{key:0,class:"ml-auto inline-flex items-center rounded-md border border-red-200 px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:G,disabled:p.value},"Supprimer",8,Ve)):k("",!0)]),default:U(()=>[l("form",{class:"space-y-3",onSubmit:Y(D,["prevent"])},[l("div",ce,[l("div",null,[e[17]||(e[17]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Jour",-1)),m(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.jour=t),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(r(),o(V,null,C(T,(t,d)=>l("option",{key:d,value:d+1},u(t),9,xe)),64))],512),[[h,a.value.jour,void 0,{number:!0}]])]),l("div",null,[e[18]||(e[18]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Salle",-1)),m(l("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.salle=t),type:"text",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[O,a.value.salle]])])]),l("div",fe,[l("div",null,[e[19]||(e[19]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Début",-1)),m(l("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.start=t),type:"time",required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[O,a.value.start]])]),l("div",null,[e[20]||(e[20]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Fin",-1)),m(l("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.end=t),type:"time",required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[O,a.value.end]])])]),l("div",ke,[l("div",null,[e[21]||(e[21]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Classe",-1)),m(l("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.classeId=t),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(r(!0),o(V,null,C(E.value,t=>(r(),o("option",{key:t.id,value:t.id},u(t.libelle||t.label||t.code),9,ge))),128))],512),[[h,a.value.classeId,void 0,{number:!0}]])]),l("div",null,[e[22]||(e[22]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Cours",-1)),m(l("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.coursId=t),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(r(!0),o(V,null,C(z.value,t=>(r(),o("option",{key:t.id,value:t.id},u(t.matiere)+" — "+u(t.intitule||t.code),9,ye))),128))],512),[[h,a.value.coursId,void 0,{number:!0}]])])]),f.value?(r(),o("p",we,u(f.value),1)):k("",!0)],32)]),_:1},8,["modelValue"])):k("",!0)]))}};export{qe as default};
