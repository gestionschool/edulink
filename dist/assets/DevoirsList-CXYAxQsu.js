import{P as q,Q as z,a as i,o as n,b as e,F as m,h as f,t as l,k as v,d as I,e as D,f as B,g as j,p as H,c,m as g}from"./index-BVVU7ImF.js";import{u as Q}from"./useCours-WlUt9X8U.js";import{u as G}from"./useClasses-6cjNtIyF.js";import{u as J}from"./usePeriodes-DPgYpSBx.js";import{u as K}from"./useTeachers-Cow4PRiH.js";const W=q("devoirs"),X=z("devoirs",W),Y={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-5"},Z=["value"],ee=["value"],te=["value"],se=["value"],oe=["value"],ae=["value"],re=["value"],le=["value"],de=["value"],ie={__name:"DevoirsFilters",props:{search:String,classeId:String,coursId:String,periodeId:String,statut:String,classesOptions:{type:Array,default:()=>[]},coursOptions:{type:Array,default:()=>[]},periodesOptions:{type:Array,default:()=>[]},statutsOptions:{type:Array,default:()=>[]}},emits:["update:search","update:classeId","update:coursId","update:periodeId","update:statut"],setup(p){return(u,o)=>(n(),i("div",Y,[e("input",{value:p.search,onInput:o[0]||(o[0]=t=>u.$emit("update:search",t.target.value)),type:"search",placeholder:"Rechercher (titre, cours, classe, prof)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,40,Z),e("select",{value:p.classeId,onChange:o[1]||(o[1]=t=>u.$emit("update:classeId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[5]||(o[5]=e("option",{value:""},"Toutes classes",-1)),(n(!0),i(m,null,f(p.classesOptions,t=>(n(),i("option",{key:t.value,value:t.value},l(t.label),9,te))),128))],40,ee),e("select",{value:p.coursId,onChange:o[2]||(o[2]=t=>u.$emit("update:coursId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[6]||(o[6]=e("option",{value:""},"Tous cours",-1)),(n(!0),i(m,null,f(p.coursOptions,t=>(n(),i("option",{key:t.value,value:t.value},l(t.label),9,oe))),128))],40,se),e("select",{value:p.periodeId,onChange:o[3]||(o[3]=t=>u.$emit("update:periodeId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[7]||(o[7]=e("option",{value:""},"Toutes périodes",-1)),(n(!0),i(m,null,f(p.periodesOptions,t=>(n(),i("option",{key:t.value,value:t.value},l(t.label),9,re))),128))],40,ae),e("select",{value:p.statut,onChange:o[4]||(o[4]=t=>u.$emit("update:statut",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[8]||(o[8]=e("option",{value:""},"Tous statuts",-1)),(n(!0),i(m,null,f(p.statutsOptions,t=>(n(),i("option",{key:t.value,value:t.value},l(t.label),9,de))),128))],40,le)]))}},ne={class:"block md:hidden divide-y divide-slate-100 dark:divide-slate-800"},ue={class:"flex items-start justify-between gap-3"},pe={class:"min-w-0"},ce={class:"font-semibold"},ve={class:"text-xs text-slate-500 dark:text-slate-400"},me=["onClick"],be={class:"mt-2 grid grid-cols-2 gap-2 text-xs text-slate-600 dark:text-slate-300"},fe={class:"col-span-2"},ge={class:"hidden min-w-full text-left text-sm md:table"},xe={class:"px-4 py-3"},ye={class:"px-4 py-3"},he={class:"px-4 py-3"},ke={class:"px-4 py-3"},_e={class:"px-4 py-3"},$e={class:"px-4 py-3"},Ie={class:"px-4 py-3"},we={class:"px-4 py-3"},Se={class:"flex justify-end gap-2"},Ce=["onClick"],Le={class:"flex items-center justify-between border-t border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},Oe={class:"text-slate-500 dark:text-slate-400"},De={__name:"DevoirsTable",props:{items:{type:Array,default:()=>[]},total:{type:Number,default:0}},emits:["remove"],setup(p){function u(o){if(!o)return"—";try{return new Date(o).toLocaleDateString()}catch{return o}}return(o,t)=>(n(),i(m,null,[e("div",ne,[(n(!0),i(m,null,f(p.items,r=>(n(),i("div",{key:r.id,class:"p-4"},[e("div",ue,[e("div",pe,[e("div",ce,l(r.titre),1),e("div",ve,l(r._coursLabel)+" • "+l(r._classeLabel),1)]),e("button",{class:"shrink-0 rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:b=>o.$emit("remove",r.id)},"Supprimer",8,me)]),e("div",be,[e("div",null,[t[0]||(t[0]=e("span",{class:"opacity-60"},"Période:",-1)),v(" "+l(r._periodeLabel),1)]),e("div",null,[t[1]||(t[1]=e("span",{class:"opacity-60"},"Date:",-1)),v(" "+l(u(r.dateRemise)),1)]),e("div",null,[t[2]||(t[2]=e("span",{class:"opacity-60"},"Prof:",-1)),v(" "+l(r._profLabel),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"opacity-60"},"Barème:",-1)),v(" "+l(r.bareme??20),1)]),e("div",fe,[t[4]||(t[4]=e("span",{class:"opacity-60"},"Statut:",-1)),v(" "+l(r.statut||"—"),1)])])]))),128))]),e("table",ge,[t[6]||(t[6]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Titre"),e("th",{class:"px-4 py-3 font-medium"},"Cours"),e("th",{class:"px-4 py-3 font-medium"},"Classe"),e("th",{class:"px-4 py-3 font-medium"},"Période"),e("th",{class:"px-4 py-3 font-medium"},"Date"),e("th",{class:"px-4 py-3 font-medium"},"Barème"),e("th",{class:"px-4 py-3 font-medium"},"Statut"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),i(m,null,f(p.items,r=>(n(),i("tr",{key:r.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",xe,l(r.titre),1),e("td",ye,l(r._coursLabel),1),e("td",he,l(r._classeLabel),1),e("td",ke,l(r._periodeLabel),1),e("td",_e,l(u(r.dateRemise)),1),e("td",$e,l(r.bareme??20),1),e("td",Ie,l(r.statut||"—"),1),e("td",we,[e("div",Se,[I(B(j),{to:`/devoirs/detail?id=${r.id}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:D(()=>[...t[5]||(t[5]=[v(" Détails ",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:b=>o.$emit("remove",r.id)}," Supprimer ",8,Ce)])])]))),128))])]),e("div",Le,[e("span",Oe,l(p.items.length)+" / "+l(p.total)+" éléments ",1)])],64))}},Be={class:"space-y-6"},je={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Ae={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},Re={key:0,class:"p-6"},Te={key:1,class:"p-6 text-sm text-red-600 dark:text-red-400"},Pe={key:2,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},Ee={key:3,class:"overflow-x-auto"},qe={__name:"DevoirsList",setup(p){const u=X(),o=Q(),t=G(),r=J(),b=K();H(async()=>{await Promise.all([t.fetch(),r.fetch(),b.fetch(),o.fetch({_sort:"code"}),u.fetch({_sort:"dateRemise",_order:"desc"})])});const w=c(()=>Object.fromEntries((o.items||[]).map(a=>[a.id,a]))),A=c(()=>Object.fromEntries((t.items||[]).map(a=>[a.id,a]))),R=c(()=>Object.fromEntries((r.items||[]).map(a=>[a.id,a]))),T=c(()=>Object.fromEntries((b.items||[]).map(a=>[a.id,a]))),S=g(""),x=g(""),y=g(""),h=g(""),k=g(""),P=c(()=>(t.items||[]).map(a=>({value:String(a.id),label:a.libelle||a.label||a.code}))),E=c(()=>(o.items||[]).map(a=>({value:String(a.id),label:`${a.code} • ${a.intitule}`}))),N=c(()=>(r.items||[]).map(a=>({value:String(a.id),label:a.label}))),U=c(()=>{const a=new Set((u.items||[]).map(s=>s.statut).filter(Boolean));return Array.from(a).sort().map(s=>({value:s,label:s}))}),C=c(()=>{const a=S.value.trim().toLowerCase();return(u.items||[]).map(s=>{const d=w.value[s.coursId],_=d?A.value[d.classeId]:null,O=R.value[s.periodeId||(d?.periodeId??null)],$=d?T.value[d.teacherId]:null;return{...s,_coursLabel:d?`${d.code} • ${d.intitule}`:"—",_matiere:d?.matiere||"—",_classeLabel:_?_.libelle||_.label||_.code:"—",_periodeLabel:O?O.label:"—",_profLabel:$?$.nom||`${$.prenom??""} ${$.nom??""}`.trim():"—"}}).filter(s=>x.value&&String(w.value[s.coursId]?.classeId)!==x.value||y.value&&String(s.coursId)!==y.value||h.value&&String(s.periodeId||w.value[s.coursId]?.periodeId)!==h.value||k.value&&s.statut!==k.value?!1:a?`${s.titre} ${s._coursLabel} ${s._matiere} ${s._classeLabel} ${s._profLabel} ${s._periodeLabel}`.toLowerCase().includes(a):!0)}),V=c(()=>u.items?.length||0),F=c(()=>u.loading||o.loading||t.loading||r.loading||b.loading),L=c(()=>u.error||o.error||t.error||r.error||b.error);async function M(a){confirm("Supprimer ce devoir ?")&&(await u.removeOne(a),await u.fetch({_sort:"dateRemise",_order:"desc"}))}return(a,s)=>(n(),i("div",Be,[e("div",je,[s[6]||(s[6]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Devoirs"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Création et suivi des devoirs par cours/période ")],-1)),I(B(j),{to:"/devoirs/nouveau",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900"},{default:D(()=>[...s[5]||(s[5]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})],-1),v(" Nouveau devoir ",-1)])]),_:1})]),I(ie,{search:S.value,"onUpdate:search":s[0]||(s[0]=d=>S.value=d),classeId:x.value,"onUpdate:classeId":s[1]||(s[1]=d=>x.value=d),coursId:y.value,"onUpdate:coursId":s[2]||(s[2]=d=>y.value=d),periodeId:h.value,"onUpdate:periodeId":s[3]||(s[3]=d=>h.value=d),statut:k.value,"onUpdate:statut":s[4]||(s[4]=d=>k.value=d),"classes-options":P.value,"cours-options":E.value,"periodes-options":N.value,"statuts-options":U.value},null,8,["search","classeId","coursId","periodeId","statut","classes-options","cours-options","periodes-options","statuts-options"]),e("div",Ae,[F.value?(n(),i("div",Re,[...s[7]||(s[7]=[e("div",{class:"h-4 w-1/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-3"},null,-1),e("div",{class:"h-4 w-full animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-2"},null,-1),e("div",{class:"h-4 w-5/6 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):L.value?(n(),i("div",Te,l(L.value),1)):C.value.length===0?(n(),i("div",Pe," Aucun devoir trouvé. ")):(n(),i("div",Ee,[I(De,{items:C.value,total:V.value,onRemove:M},null,8,["items","total"])]))])]))}};export{qe as default};
