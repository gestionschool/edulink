import{i,o as a,e as S,b as t,a as c,t as m,E as Y,f as H,g as L,x as n,k as B,F as T,h as K,u as Q,c as M,m as I,r as R,p as J,M as q,d as w,n as W}from"./index-BVVU7ImF.js";const X={class:"flex items-center justify-between"},ee={class:"text-xs text-slate-500 dark:text-slate-400"},te={key:0,class:"mt-2 h-6 w-20 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},se={key:1,class:"mt-1 text-2xl font-semibold"},ae={class:"rounded-xl bg-violet-50 p-2 text-violet-700 dark:bg-violet-900/30 dark:text-violet-200"},re=["innerHTML"],E={__name:"KpiCard",props:{title:String,value:[String,Number],icon:String,loading:Boolean,to:String},setup(r){function d(f){const u={building:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 21h18V3H3v18zm2-2V5h14v14H5zM7 7h4v4H7V7z"/></svg>',classroom:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 5h18v12H3zM5 7v8h14V7H5zm-2 12h18v2H3z"/></svg>',student:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3 1 8l11 5 8-3.636V15h2V8L12 3Zm0 13L6 13v3.5C6 18.985 8.686 21 12 21s6-2.015 6-4.5V13l-6 3Z"/></svg>',users:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V20h10v-3.5C11 14.17 6.33 13 4 13zm12 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.93 1.97 3.45V20h5v-3.5C22 14.17 17.33 13 16 13z"/></svg>',book:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12V2zM6 4h10v14H6a2 2 0 0 0-2 2V4z"/></svg>'};return u[f]??u.classroom}return(f,u)=>(a(),i(Y(r.to?H(L):"div"),{to:r.to,class:"group block rounded-2xl border border-slate-200 bg-white p-4 shadow-sm transition hover:shadow-md dark:border-slate-800 dark:bg-slate-900"},{default:S(()=>[t("div",X,[t("div",null,[t("p",ee,m(r.title),1),r.loading?(a(),c("div",te)):(a(),c("p",se,m(r.value??"—"),1))]),t("div",ae,[t("span",{class:"inline-block h-6 w-6",innerHTML:d(r.icon)},null,8,re)])])]),_:1},8,["to"]))}},oe={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900"},le={class:"mb-3 flex items-center justify-between"},ne={class:"text-sm font-semibold"},ie={key:0,class:"space-y-2"},ue={key:0,class:"space-y-2"},de={class:"flex items-center justify-between"},ce={class:"flex min-w-0 items-center gap-2"},ve=["innerHTML"],me={class:"truncate font-medium"},he={class:"shrink-0 text-xs text-slate-500 dark:text-slate-400"},ge={key:0,class:"mt-1 truncate text-xs text-slate-500 dark:text-slate-400"},xe={key:1,class:"text-sm text-slate-500 dark:text-slate-400"},$={__name:"UpcomingCard",props:{title:String,items:{type:Array,default:()=>[]},emptyText:{type:String,default:"Aucun élément"},icon:String,loading:Boolean,to:String},setup(r){function d(l){return String(l).padStart(2,"0")}function f(l){return l instanceof Date&&!isNaN(+l)}function u(l){if(!l)return"—";const o=new Date(l);return f(o)?`${d(o.getDate())}/${d(o.getMonth()+1)}/${o.getFullYear()}`:"—"}function y(l){const o={task:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 11h8v2H9zm0-4h8v2H9zm0 8h8v2H9zM7 7H5v2h2V7zm0 4H5v2h2v-2zm0 4H5v2h2v-2z"/></svg>',quiz:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18h2v2h-2v-2zm1-16C6.48 2 2 6.48 2 12h2a8 8 0 1 1 8 8v2c5.52 0 10-4.48 10-10S17.52 2 12 2zm-1 5h2v6h-2V7z"/></svg>'};return o[l]??o.task}return(l,o)=>(a(),c("div",oe,[t("div",le,[t("h3",ne,m(r.title),1),r.to?(a(),i(H(L),{key:0,to:r.to,class:"text-xs text-violet-700 hover:underline dark:text-violet-300"},{default:S(()=>[...o[0]||(o[0]=[B(" Tout voir ",-1)])]),_:1},8,["to"])):n("",!0)]),r.loading?(a(),c("div",ie,[...o[1]||(o[1]=[t("div",{class:"h-4 w-3/4 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1),t("div",{class:"h-4 w-2/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1),t("div",{class:"h-4 w-1/2 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):(a(),c(T,{key:1},[r.items&&r.items.length?(a(),c("ul",ue,[(a(!0),c(T,null,K(r.items,b=>(a(),c("li",{key:`${r.title}-${b.id}`,class:"rounded-lg border border-slate-200 p-3 text-sm dark:border-slate-800"},[t("div",de,[t("div",ce,[t("span",{class:"inline-flex h-6 w-6 items-center justify-center rounded-md bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200",innerHTML:y(r.icon)},null,8,ve),t("span",me,m(b.titre||b.title),1)]),t("span",he,m(u(b.date||b.dateRemise)),1)]),b.__extra?(a(),c("p",ge,m(b.__extra),1)):n("",!0)]))),128))])):(a(),c("p",xe,m(r.emptyText),1))],64))]))}},fe={class:"inline-flex items-center gap-2"},be=["innerHTML"],pe={class:"font-medium"},v={__name:"QuickAction",props:{label:String,to:String,icon:String},setup(r){function d(f){const u={plus:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></svg>',shield:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l8 4v6c0 5-3.5 9.74-8 10-4.5-.26-8-5-8-10V6l8-4z"/></svg>',chart:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h2v18H3zM8 13h2v8H8zM13 9h2v12h-2zM18 5h2v16h-2z"/></svg>',layers:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3 1 9l11 6 11-6-11-6zm0 9L1 18l11 6 11-6-11-6z"/></svg>',student:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3 1 8l11 5 8-3.636V15h2V8L12 3Zm0 13L6 13v3.5C6 18.985 8.686 21 12 21s6-2.015 6-4.5V13l-6 3Z"/></svg>',book:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12V2zM6 4h10v14H6a2 2 0 0 0-2 2V4z"/></svg>',quiz:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18h2v2h-2v-2zm1-16C6.48 2 2 6.48 2 12h2a8 8 0 1 1 8 8v2c5.52 0 10-4.48 10-10S17.52 2 12 2zm-1 5h2v6h-2V7z"/></svg>',attendance:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 5h16v2H4zM4 9h10v2H4zm0 4h16v2H4zm0 4h10v2H4z"/></svg>',edit:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/></svg>',classroom:'<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 5h18v12H3zM5 7v8h14V7H5zm-2 12h18v2H3z"/></svg>'};return u[f]??u.layers}return(f,u)=>(a(),i(H(L),{to:r.to,class:"group inline-flex items-center justify-between rounded-xl border border-slate-200 bg-white px-3 py-3 text-sm shadow-sm transition hover:shadow-md dark:border-slate-800 dark:bg-slate-900"},{default:S(()=>[t("span",fe,[t("span",{class:"h-5 w-5",innerHTML:d(r.icon)},null,8,be),t("span",pe,m(r.label),1)]),u[0]||(u[0]=t("svg",{class:"h-4 w-4 opacity-60 transition group-hover:translate-x-0.5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M7.22 14.28a.75.75 0 0 1 0-1.06L10.44 10 7.22 6.78a.75.75 0 1 1 1.06-1.06l3.5 3.5a.75.75 0 0 1 0 1.06l-3.5 3.5a.75.75 0 0 1-1.06 0z","clip-rule":"evenodd"})],-1))]),_:1},8,["to"]))}},ke={class:"space-y-6"},we={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between rounded-2xl border border-slate-200 bg-white p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900"},ye={class:"text-xl font-semibold"},_e={class:"flex items-center gap-2"},ze=["title"],Me={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5"},Ce={class:"grid grid-cols-1 gap-4 xl:grid-cols-3"},De={class:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900"},Ee={class:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4"},Ae={key:0,class:"text-sm text-red-600 dark:text-red-400"},He={__name:"DashboardHome",setup(r){const d=Q(),f=M(()=>d.user?.name||"Utilisateur"),u=M(()=>{const e=d.user?.role;return e==="ADMIN_GENERALE"?"Admin général":e==="ADMIN_ECOLE"?"Admin école":e==="PROFESSEUR"?"Professeur":e==="ELEVE"?"Élève":e==="PARENT_TUTEUR"?"Parent / Tuteur":"Invité"}),y=M(()=>d.user?.role==="ADMIN_GENERALE"),l=M(()=>["ADMIN_ECOLE","ADMIN_GENERALE"].includes(d.user?.role)),o=M(()=>["PROFESSEUR","ADMIN_ECOLE","ADMIN_GENERALE"].includes(d.user?.role)),b=M(()=>y.value?"bg-violet-500":l.value?"bg-emerald-500":o.value?"bg-sky-500":"bg-slate-400"),h=I(!0),A=I(null),g=R({ecoles:0,classes:0,students:0,teachers:0,cours:0}),_=R({devoirs:[],interros:[],examens:[]});J(O);async function O(){h.value=!0,A.value=null;try{const e=await P();g.ecoles=await C(e?.ecoles,"/ecoles"),g.classes=await C(e?.classes,"/classes"),g.students=await C(e?.students,"/students"),g.teachers=await C(e?.teachers,"/teachers"),g.cours=await C(e?.cours,"/cours"),_.devoirs=await V(e?.devoirs,"/devoirs","dateRemise"),_.interros=await V(e?.interros,"/interros","date"),_.examens=await V(e?.examens,"/examens","date")}catch(e){A.value=e?.message||"Impossible de charger le tableau de bord.",console.warn("[Dashboard] load error:",e)}finally{h.value=!1}}async function P(){const e={};return await Promise.allSettled([k("@/stores/useEcoles").then(s=>e.ecoles=s?.useEcoles?.()),k("@/stores/useClasses").then(s=>e.classes=s?.useClasses?.()),k("@/stores/useStudents").then(s=>e.students=s?.useStudents?.()),k("@/stores/useTeachers").then(s=>e.teachers=s?.useTeachers?.()),k("@/stores/useCours").then(s=>e.cours=s?.useCours?.()),k("@/stores/useDevoirs").then(s=>e.devoirs=s?.useDevoirs?.()),k("@/stores/useInterros").then(s=>e.interros=s?.useInterros?.()),k("@/stores/useExamens").then(s=>e.examens=s?.useExamens?.())]),await Promise.allSettled([e.ecoles?.ensureLoaded?.(),e.classes?.ensureLoaded?.(),e.students?.ensureLoaded?.(),e.teachers?.ensureLoaded?.(),e.cours?.ensureLoaded?.(),e.devoirs?.ensureLoaded?.(),e.interros?.ensureLoaded?.(),e.examens?.ensureLoaded?.()]),e}async function k(e){try{return await import(e)}catch{return{}}}async function C(e,s){const x=(Array.isArray(e?.items)&&e.items.length)??(Array.isArray(e?.list)&&e.list.length);if(typeof x=="number")return x;const z=await q.get(s);return Array.isArray(z)?z.length:0}async function V(e,s,x){let z=[];Array.isArray(e?.items)&&e.items.length?z=e.items:z=await q.get(s);const N=new Date,Z=G(N,7);return z.filter(p=>{const D=new Date(p[x]);return j(D)&&D>=F(N)&&D<=U(Z)}).sort((p,D)=>new Date(p[x])-new Date(D[x])).slice(0,5).map(p=>({...p,__extra:[p.classe?`Classe: ${p.classe}`:void 0,p.cours?`Cours: ${p.cours}`:void 0].filter(Boolean).join(" • ")}))}function j(e){return e instanceof Date&&!isNaN(+e)}function F(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)}function U(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}function G(e,s){const x=new Date(e);return x.setDate(x.getDate()+s),x}return(e,s)=>(a(),c("div",ke,[t("header",we,[t("div",null,[t("h1",ye," Bonjour, "+m(f.value),1),s[0]||(s[0]=t("p",{class:"mt-1 text-sm text-slate-500 dark:text-slate-400"}," Tableau de bord — aperçu global ",-1))]),t("div",_e,[t("span",{class:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-medium dark:border-slate-700 dark:bg-slate-800",title:`Rôle: ${u.value}`},[t("span",{class:W(["h-2 w-2 rounded-full",b.value])},null,2),B(" "+m(u.value),1)],8,ze),w(H(L),{to:"/rapports/academiques",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-50 px-3 py-1.5 text-xs font-medium text-violet-700 hover:bg-violet-100 dark:border-violet-900 dark:bg-violet-900/30 dark:text-violet-200 dark:hover:bg-violet-900/50"},{default:S(()=>[...s[1]||(s[1]=[B(" Voir les rapports ",-1),t("svg",{class:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{d:"M7 10l5 5V5l-5 5z"})],-1)])]),_:1})])]),t("section",Me,[y.value?(a(),i(E,{key:0,title:"Écoles",value:g.ecoles,icon:"building",loading:h.value,to:"/admin/ecoles"},null,8,["value","loading"])):n("",!0),w(E,{title:"Classes",value:g.classes,icon:"classroom",loading:h.value,to:"/classes"},null,8,["value","loading"]),w(E,{title:"Élèves",value:g.students,icon:"student",loading:h.value,to:"/communautes/etudiants"},null,8,["value","loading"]),w(E,{title:"Professeurs",value:g.teachers,icon:"users",loading:h.value,to:"/communautes/professeurs"},null,8,["value","loading"]),w(E,{title:"Cours",value:g.cours,icon:"book",loading:h.value,to:"/cours"},null,8,["value","loading"])]),t("section",Ce,[w($,{title:"Devoirs à venir",items:_.devoirs,"empty-text":"Aucun devoir à venir",icon:"task",loading:h.value,to:"/devoirs"},null,8,["items","loading"]),w($,{title:"Interros à venir",items:_.interros,"empty-text":"Aucune interrogation à venir",icon:"quiz",loading:h.value,to:"/interros"},null,8,["items","loading"]),w($,{title:"Examens à venir",items:_.examens,"empty-text":"Aucun examen à venir",icon:"quiz",loading:h.value,to:"/examens"},null,8,["items","loading"])]),t("section",De,[s[2]||(s[2]=t("h2",{class:"mb-4 text-base font-semibold"},"Actions rapides",-1)),t("div",Ee,[y.value?(a(),i(v,{key:0,label:"Créer une école",to:"/admin/ecoles",icon:"plus"})):n("",!0),y.value?(a(),i(v,{key:1,label:"Gérer utilisateurs",to:"/admin/utilisateurs",icon:"shield"})):n("",!0),y.value?(a(),i(v,{key:2,label:"Rapports académiques",to:"/rapports/academiques",icon:"chart"})):n("",!0),l.value?(a(),i(v,{key:3,label:"Ajouter une classe",to:"/classes",icon:"layers"})):n("",!0),l.value?(a(),i(v,{key:4,label:"Inscrire un élève",to:"/communautes/etudiants",icon:"student"})):n("",!0),l.value?(a(),i(v,{key:5,label:"Créer un cours",to:"/cours",icon:"book"})):n("",!0),l.value?(a(),i(v,{key:6,label:"Planifier un examen",to:"/examens",icon:"quiz"})):n("",!0),o.value?(a(),i(v,{key:7,label:"Marquer les présences",to:"/presences/marque",icon:"attendance"})):n("",!0),o.value?(a(),i(v,{key:8,label:"Créer un devoir",to:"/devoirs",icon:"task"})):n("",!0),o.value?(a(),i(v,{key:9,label:"Saisir des notes",to:"/notes",icon:"edit"})):n("",!0),o.value?(a(),i(v,{key:10,label:"Voir mes classes",to:"/classes",icon:"classroom"})):n("",!0)])]),A.value?(a(),c("p",Ae,m(A.value),1)):n("",!0)]))}};export{He as default};
