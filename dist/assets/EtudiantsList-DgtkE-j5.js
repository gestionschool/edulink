import{s as Q,f as i,r as k,g as G,o as g,h as m,u as H,a as o,i as f,w as l,c as b,F as V,j as $,t as S,k as y,d as n,v as c}from"./index-BjUAzvaQ.js";import{u as J}from"./school-CHXg0hx7.js";import{_ as W}from"./PageHeader-DhanqyjH.js";import{_ as X,a as Y}from"./CrudModal-Bs5nhJF3.js";import{_ as Z}from"./DataTable-C4q2Au5h.js";import{A as ee}from"./AppLayout-BFNFHsQg.js";const re={class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors"},te={class:"mx-auto max-w-6xl p-4 sm:p-6"},oe=["value"],ae={class:"rounded-xl border border-gray-200 bg-white p-3 shadow-sm dark:border-gray-700 dark:bg-gray-900"},se={class:"flex gap-2"},de=["onClick"],le={class:"grid gap-3 sm:grid-cols-2"},ne={class:"text-gray-700 dark:text-gray-200"},ie={class:"text-gray-700 dark:text-gray-200"},ue={class:"text-gray-700 dark:text-gray-200"},ge={class:"text-gray-700 dark:text-gray-200"},me=["value"],ce={class:"text-gray-700 dark:text-gray-200"},pe={class:"text-gray-700 dark:text-gray-200"},fe={class:"text-gray-700 dark:text-gray-200"},Ce={__name:"EtudiantsList",setup(be){const U=[{key:"matricule",label:"Matricule"},{key:"nom",label:"Nom"},{key:"prenom",label:"Prénom"},{key:"classe",label:"Classe"},{key:"tuteur",label:"Tuteur"},{key:"telephone",label:"Téléphone"},{key:"statut",label:"Statut"},{key:"_actions",label:"Actions"}],p=J(),{students:q,classes:v,uniqueStudentClasses:E,periodes:x}=Q(p),T=i(()=>Object.fromEntries(v.value.map(r=>[r.id,r.label]))),_=i(()=>Object.fromEntries(v.value.map(r=>[r.label,r.id]))),w=i(()=>E.value),s=k({q:"",classe:"",statut:""});function h(r){return String(r||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"")}const A=i(()=>q.value.map(r=>({id:r.id,matricule:r.matricule||"",nom:r.nom||"",prenom:r.prenom||"",classe:T.value[r.classeId]||r.classe||"",tuteur:r.tuteur||"",telephone:r.telephone||"",statut:r.statut||"Actif"}))),I=i(()=>{const r=h(s.value.q),e=s.value.classe,t=s.value.statut;return A.value.filter(d=>{const j=h(`${d.matricule} ${d.nom} ${d.prenom} ${d.classe} ${d.tuteur} ${d.telephone} ${d.statut}`),P=r?j.includes(r):!0,z=e?d.classe===e:!0,K=t?d.statut===t:!0;return P&&z&&K})});function N(){s.value={q:"",classe:"",statut:""}}function R(){}const u=k(!1),a=k({id:null,matricule:"",nom:"",prenom:"",classe:"",tuteur:"",telephone:"",statut:"Actif"});function B(){a.value={id:null,matricule:"",nom:"",prenom:"",classe:"",tuteur:"",telephone:"",statut:"Actif"},u.value=!0}function F(r){a.value={...r},u.value=!0}async function L(){const r={...a.value},e=_.value[r.classe]??null;if(r.id)p.updateEtudiant({id:r.id,...r,classeId:e});else{const t=p.addEtudiant({...r,classeId:e});a.value.id=t}u.value=!1}async function M(r){p.removeEtudiant(r.id)}const D=H(),C=i(()=>x.value.find(r=>r.active)?.id??x.value[0]?.id??null);function O(r){!r?.id||!C.value||D.push({name:"bulletin",params:{eleveId:r.id,periodeId:C.value}})}return(r,e)=>(g(),G(ee,null,{default:m(()=>[o("div",re,[o("div",te,[f(W,{title:"Étudiants"},{actions:m(()=>[o("button",{class:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-indigo-500 dark:hover:bg-indigo-600 dark:focus:ring-indigo-400",onClick:e[0]||(e[0]=t=>B())}," Nouveau ")]),_:1}),f(X,{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value=t),onReset:N},{default:m(()=>[l(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.classe=t),class:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 dark:focus:border-indigo-400 dark:focus:ring-indigo-400"},[e[12]||(e[12]=o("option",{value:""},"Classe",-1)),(g(!0),b(V,null,$(w.value,t=>(g(),b("option",{key:t,value:t},S(t),9,oe))),128))],512),[[y,s.value.classe]]),l(o("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.statut=t),class:"rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 dark:focus:border-indigo-400 dark:focus:ring-indigo-400"},[...e[13]||(e[13]=[o("option",{value:""},"Statut",-1),o("option",null,"Actif",-1),o("option",null,"Suspendu",-1)])],512),[[y,s.value.statut]]),o("button",{class:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-700 dark:focus:ring-indigo-400",onClick:R}," Filtrer ")]),_:1},8,["modelValue"]),o("div",ae,[f(Z,{rows:I.value,headers:U,idKey:"id",onEdit:F,onRemove:M},{"actions-extra":m(({row:t})=>[o("div",se,[o("button",{class:"mr-2 inline-flex items-center rounded-md px-2.5 py-1.5 text-xs font-medium text-blue-700 hover:underline focus:outline-none focus:ring-2 focus:ring-blue-500 dark:text-blue-400 dark:focus:ring-blue-400",onClick:d=>O(t)}," Bulletin ",8,de)])]),_:1},8,["rows"])]),f(Y,{open:u.value,title:a.value.id?"Modifier étudiant":"Créer étudiant",onClose:e[11]||(e[11]=t=>u.value=!1),onSubmit:L},{default:m(()=>[o("div",le,[o("label",ne,[e[14]||(e[14]=n(" Matricule ",-1)),l(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.matricule=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm placeholder-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 dark:focus:border-indigo-400 dark:focus:ring-indigo-400",required:""},null,512),[[c,a.value.matricule]])]),o("label",ie,[e[15]||(e[15]=n(" Nom ",-1)),l(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.nom=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm placeholder-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 dark:focus:border-indigo-400 dark:focus:ring-indigo-400",required:""},null,512),[[c,a.value.nom]])]),o("label",ue,[e[16]||(e[16]=n(" Prénom ",-1)),l(o("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.prenom=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm placeholder-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 dark:focus;border-indigo-400 dark:focus:ring-indigo-400",required:""},null,512),[[c,a.value.prenom]])]),o("label",ge,[e[18]||(e[18]=n(" Classe ",-1)),l(o("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.classe=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus:border-indigo-400 dark:focus:ring-indigo-400",required:""},[e[17]||(e[17]=o("option",{disabled:"",value:""},"— choisir —",-1)),(g(!0),b(V,null,$(w.value,t=>(g(),b("option",{key:`form-${t}`,value:t},S(t),9,me))),128))],512),[[y,a.value.classe]])]),o("label",ce,[e[19]||(e[19]=n(" Tuteur ",-1)),l(o("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.tuteur=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm placeholder-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 dark:focus:border-indigo-400 dark:focus:ring-indigo-400"},null,512),[[c,a.value.tuteur]])]),o("label",pe,[e[20]||(e[20]=n(" Téléphone ",-1)),l(o("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.telephone=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm placeholder-gray-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 dark:focus:border-indigo-400 dark:focus:ring-indigo-400"},null,512),[[c,a.value.telephone]])]),o("label",fe,[e[22]||(e[22]=n(" Statut ",-1)),l(o("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.statut=t),class:"mt-1 w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:focus;border-indigo-400 dark:focus:ring-indigo-400"},[...e[21]||(e[21]=[o("option",null,"Actif",-1),o("option",null,"Suspendu",-1)])],512),[[y,a.value.statut]])])])]),_:1},8,["open","title"])])])]),_:1}))}};export{Ce as default};
