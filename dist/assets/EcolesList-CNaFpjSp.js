import{a as d,o as l,s as $,J as u,K as C,m as S,c as h,p as A,i as V,e as b,G as B,k as y,b as r,F as L,h as D,x as p,t as n,j as E,I as F}from"./index-vgNnEmJo.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N={},R={class:"bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 md:p-6"};function j(s,e){return l(),d("section",R,[$(s.$slots,"default")])}const I=M(N,[["render",j]]),P=s=>({list:(e={})=>u.get(`/${s}`,e),get:e=>u.get(`/${s}/${e}`),create:e=>u.post(`/${s}`,e),update:(e,t)=>u.patch(`/${s}/${e}`,t),remove:e=>u.del(`/${s}/${e}`)}),m=P("ecoles"),T=C("ecoles",{state:()=>({items:[],loading:!1,error:null,lastFetchedAt:null}),getters:{byId:s=>e=>s.items.find(t=>String(t.id)===String(e))||null,total:s=>s.items.length,sorted:s=>[...s.items].sort((e,t)=>(e.nom||"").localeCompare(t.nom||""))},actions:{async fetchAll(s=!1){if(!this.loading&&!(!s&&this.items.length)){this.loading=!0,this.error=null;try{const e=await m.list();this.items=(Array.isArray(e)?e:[]).map(t=>({id:t.id,nom:t.nom??t.name??"—",code:t.code??"—",ville:t.ville??t.city??"—",directeur:t.directeur??t.director??"—",telephone:t.telephone??t.phone??"",email:t.email??"",...t})),this.lastFetchedAt=Date.now()}catch(e){this.error=e}finally{this.loading=!1}}},async create(s){const e=await m.create(s);return this.items.unshift(e),e},async update(s,e){const t=await m.update(s,e),c=this.items.findIndex(x=>x.id===s);return c>=0&&(this.items[c]={...this.items[c],...t}),t},async remove(s){await m.remove(s),this.items=this.items.filter(e=>e.id!==s)}}}),U={class:"flex items-center gap-2"},q={key:0,class:"py-12 text-center text-slate-500"},z={key:1,class:"py-6 rounded-md border border-red-300 bg-red-50 px-4 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300"},G={key:2,class:"py-12 text-center text-slate-500"},H={key:3,class:"overflow-x-auto rounded-xl border border-slate-200 dark:border-slate-800"},J={class:"min-w-full divide-y divide-slate-200 dark:divide-slate-800"},K={class:"divide-y divide-slate-200 dark:divide-slate-800"},O={class:"px-4 py-3"},Q={class:"font-medium"},W={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},X={key:0},Y={key:1},Z={key:2},ee={class:"px-4 py-3"},te={class:"px-4 py-3"},se={class:"px-4 py-3"},re={class:"px-4 py-3"},oe={class:"flex justify-end gap-2"},ae=["onClick"],le=["onClick"],ne={__name:"EcolesList",setup(s){const e=T();B();const t=S(""),c=h(()=>e.loading),x=h(()=>e.error),f=h(()=>e.sorted),v=h(()=>{const i=t.value.trim().toLowerCase();return i?f.value.filter(a=>[a.nom,a.code,a.ville,a.directeur,a.email,a.telephone].filter(Boolean).join(" ").toLowerCase().includes(i)):f.value});function _(){e.fetchAll(!0)}function k(i){alert(`(MVP) Éditer #${i.id} – ${i.nom}`)}async function g(i){confirm(`Supprimer l'école "${i.nom}" ?`)&&await e.remove(i.id)}return A(()=>{e.fetchAll()}),(i,a)=>(l(),V(I,{title:"Écoles",subtitle:`${v.value.length} établissement(s)`},{actions:b(()=>[r("div",U,[E(r("input",{"onUpdate:modelValue":a[0]||(a[0]=o=>t.value=o),type:"search",placeholder:"Rechercher (nom, code, ville, directeur)…",class:"w-64 max-w-[70vw] rounded-md border border-slate-300 bg-white px-3 py-2 text-sm placeholder-slate-400 focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:placeholder-slate-500 dark:focus:border-violet-400 dark:focus:ring-violet-400"},null,512),[[F,t.value]]),r("button",{class:"inline-flex items-center gap-2 rounded-md border px-3 py-2 text-sm border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800",onClick:_},[...a[1]||(a[1]=[r("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[r("path",{d:"M17.65 6.35A7.95 7.95 0 0 0 12 4V1L7 6l5 5V7a6 6 0 1 1-6 6H4a8 8 0 1 0 13.65-6.65z"})],-1),y(" Rafraîchir ",-1)])])])]),default:b(()=>[c.value?(l(),d("div",q,"Chargement…")):x.value?(l(),d("div",z,[a[2]||(a[2]=y(" Une erreur est survenue. ",-1)),r("button",{class:"underline",onClick:_},"Réessayer")])):v.value.length?(l(),d("div",H,[r("table",J,[a[3]||(a[3]=r("thead",{class:"bg-slate-50 dark:bg-slate-900/50"},[r("tr",{class:"text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400"},[r("th",{class:"px-4 py-3"},"Nom"),r("th",{class:"px-4 py-3"},"Code"),r("th",{class:"px-4 py-3"},"Ville"),r("th",{class:"px-4 py-3"},"Directeur"),r("th",{class:"px-4 py-3 w-24 text-right"},"Actions")])],-1)),r("tbody",K,[(l(!0),d(L,null,D(v.value,o=>(l(),d("tr",{key:o.id,class:"text-sm"},[r("td",O,[r("div",Q,n(o.nom||"—"),1),o.email||o.telephone?(l(),d("div",W,[o.email?(l(),d("span",X,n(o.email),1)):p("",!0),o.email&&o.telephone?(l(),d("span",Y," • ")):p("",!0),o.telephone?(l(),d("span",Z,n(o.telephone),1)):p("",!0)])):p("",!0)]),r("td",ee,n(o.code||"—"),1),r("td",te,n(o.ville||"—"),1),r("td",se,n(o.directeur||"—"),1),r("td",re,[r("div",oe,[r("button",{class:"rounded-md border border-slate-300 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800",onClick:w=>k(o)},"Éditer",8,ae),r("button",{class:"rounded-md border border-red-300 px-2 py-1 text-xs text-red-700 hover:bg-red-50 dark:border-red-800 dark:text-red-300 dark:hover:bg-red-900/20",onClick:w=>g(o)},"Suppr.",8,le)])])]))),128))])])])):(l(),d("div",G," Aucune école trouvée. "))]),_:1},8,["subtitle"]))}};export{ne as default};
