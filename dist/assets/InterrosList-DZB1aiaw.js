import{P as q,Q as z,a as i,o as n,b as e,F as v,h as f,t as a,k as b,d as I,e as B,f as T,g as j,p as G,c,m as g}from"./index-BVVU7ImF.js";import{u as H}from"./useCours-WlUt9X8U.js";import{u as Q}from"./useClasses-6cjNtIyF.js";import{u as J}from"./usePeriodes-DPgYpSBx.js";import{u as K}from"./useTeachers-Cow4PRiH.js";const W=q("interros"),X=z("interros",W),Y={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-5"},Z=["value"],ee=["value"],te=["value"],se=["value"],oe=["value"],re=["value"],le=["value"],ae=["value"],de=["value"],ie={__name:"InterrosFilters",props:{search:String,classeId:String,coursId:String,periodeId:String,type:String,classesOptions:{type:Array,default:()=>[]},coursOptions:{type:Array,default:()=>[]},periodesOptions:{type:Array,default:()=>[]},typesOptions:{type:Array,default:()=>[]}},emits:["update:search","update:classeId","update:coursId","update:periodeId","update:type"],setup(p){return(u,o)=>(n(),i("div",Y,[e("input",{value:p.search,onInput:o[0]||(o[0]=t=>u.$emit("update:search",t.target.value)),type:"search",placeholder:"Rechercher (titre, cours, classe, prof)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,40,Z),e("select",{value:p.classeId,onChange:o[1]||(o[1]=t=>u.$emit("update:classeId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[5]||(o[5]=e("option",{value:""},"Toutes classes",-1)),(n(!0),i(v,null,f(p.classesOptions,t=>(n(),i("option",{key:t.value,value:t.value},a(t.label),9,te))),128))],40,ee),e("select",{value:p.coursId,onChange:o[2]||(o[2]=t=>u.$emit("update:coursId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[6]||(o[6]=e("option",{value:""},"Tous cours",-1)),(n(!0),i(v,null,f(p.coursOptions,t=>(n(),i("option",{key:t.value,value:t.value},a(t.label),9,oe))),128))],40,se),e("select",{value:p.periodeId,onChange:o[3]||(o[3]=t=>u.$emit("update:periodeId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[7]||(o[7]=e("option",{value:""},"Toutes périodes",-1)),(n(!0),i(v,null,f(p.periodesOptions,t=>(n(),i("option",{key:t.value,value:t.value},a(t.label),9,le))),128))],40,re),e("select",{value:p.type,onChange:o[4]||(o[4]=t=>u.$emit("update:type",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[8]||(o[8]=e("option",{value:""},"Tous types",-1)),(n(!0),i(v,null,f(p.typesOptions,t=>(n(),i("option",{key:t.value,value:t.value},a(t.label),9,de))),128))],40,ae)]))}},ne={class:"block md:hidden divide-y divide-slate-100 dark:divide-slate-800"},ue={class:"flex items-start justify-between gap-3"},pe={class:"min-w-0"},ce={class:"font-semibold"},ve={class:"text-xs text-slate-500 dark:text-slate-400"},me=["onClick"],be={class:"mt-2 grid grid-cols-2 gap-2 text-xs text-slate-600 dark:text-slate-300"},fe={class:"hidden min-w-full text-left text-sm md:table"},ge={class:"px-4 py-3"},ye={class:"px-4 py-3"},xe={class:"px-4 py-3"},he={class:"px-4 py-3"},ke={class:"px-4 py-3"},_e={class:"px-4 py-3"},$e={class:"px-4 py-3"},Ie={class:"px-4 py-3"},we={class:"flex justify-end gap-2"},Ce=["onClick"],Le={class:"flex items-center justify-between border-t border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},Se={class:"text-slate-500 dark:text-slate-400"},Oe={__name:"InterrosTable",props:{items:{type:Array,default:()=>[]},total:{type:Number,default:0}},emits:["remove"],setup(p){function u(o){if(!o)return"—";try{return new Date(o).toLocaleDateString()}catch{return o}}return(o,t)=>(n(),i(v,null,[e("div",ne,[(n(!0),i(v,null,f(p.items,l=>(n(),i("div",{key:l.id,class:"p-4"},[e("div",ue,[e("div",pe,[e("div",ce,a(l.titre),1),e("div",ve,a(l._coursLabel)+" • "+a(l._classeLabel),1)]),e("button",{class:"shrink-0 rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:m=>o.$emit("remove",l.id)},"Supprimer",8,me)]),e("div",be,[e("div",null,[t[0]||(t[0]=e("span",{class:"opacity-60"},"Type:",-1)),b(" "+a(l.type||"—"),1)]),e("div",null,[t[1]||(t[1]=e("span",{class:"opacity-60"},"Date:",-1)),b(" "+a(u(l.date)),1)]),e("div",null,[t[2]||(t[2]=e("span",{class:"opacity-60"},"Prof:",-1)),b(" "+a(l._profLabel),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"opacity-60"},"Barème:",-1)),b(" "+a(l.bareme??10),1)])])]))),128))]),e("table",fe,[t[5]||(t[5]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Titre"),e("th",{class:"px-4 py-3 font-medium"},"Type"),e("th",{class:"px-4 py-3 font-medium"},"Cours"),e("th",{class:"px-4 py-3 font-medium"},"Classe"),e("th",{class:"px-4 py-3 font-medium"},"Période"),e("th",{class:"px-4 py-3 font-medium"},"Date"),e("th",{class:"px-4 py-3 font-medium"},"Barème"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),i(v,null,f(p.items,l=>(n(),i("tr",{key:l.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",ge,a(l.titre),1),e("td",ye,a(l.type||"—"),1),e("td",xe,a(l._coursLabel),1),e("td",he,a(l._classeLabel),1),e("td",ke,a(l._periodeLabel),1),e("td",_e,a(u(l.date)),1),e("td",$e,a(l.bareme??10),1),e("td",Ie,[e("div",we,[I(T(j),{to:`/interros/detail?id=${l.id}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:B(()=>[...t[4]||(t[4]=[b(" Détails ",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:m=>o.$emit("remove",l.id)}," Supprimer ",8,Ce)])])]))),128))])]),e("div",Le,[e("span",Se,a(p.items.length)+" / "+a(p.total)+" éléments ",1)])],64))}},Be={class:"space-y-6"},Te={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},je={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},Ae={key:0,class:"p-6"},De={key:1,class:"p-6 text-sm text-red-600 dark:text-red-400"},Pe={key:2,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},Ee={key:3,class:"overflow-x-auto"},Me={__name:"InterrosList",setup(p){const u=X(),o=H(),t=Q(),l=J(),m=K();G(async()=>{await Promise.all([t.fetch(),l.fetch(),m.fetch(),o.fetch({_sort:"code"}),u.fetch({_sort:"date",_order:"desc"})])});const w=c(()=>Object.fromEntries((o.items||[]).map(r=>[r.id,r]))),A=c(()=>Object.fromEntries((t.items||[]).map(r=>[r.id,r]))),D=c(()=>Object.fromEntries((l.items||[]).map(r=>[r.id,r]))),P=c(()=>Object.fromEntries((m.items||[]).map(r=>[r.id,r]))),C=g(""),y=g(""),x=g(""),h=g(""),k=g(""),E=c(()=>(t.items||[]).map(r=>({value:String(r.id),label:r.libelle||r.label||r.code}))),N=c(()=>(o.items||[]).map(r=>({value:String(r.id),label:`${r.code} • ${r.intitule}`}))),U=c(()=>(l.items||[]).map(r=>({value:String(r.id),label:r.label}))),R=c(()=>{const r=new Set((u.items||[]).map(s=>s.type).filter(Boolean));return Array.from(r).sort().map(s=>({value:s,label:s}))}),L=c(()=>{const r=C.value.trim().toLowerCase();return(u.items||[]).map(s=>{const d=w.value[s.coursId],_=d?A.value[d.classeId]:null,O=D.value[d?.periodeId??null],$=d?P.value[d.teacherId]:null;return{...s,_coursLabel:d?`${d.code} • ${d.intitule}`:"—",_matiere:d?.matiere||"—",_classeLabel:_?_.libelle||_.label||_.code:"—",_periodeLabel:O?O.label:"—",_profLabel:$?$.nom||`${$.prenom??""} ${$.nom??""}`.trim():"—"}}).filter(s=>y.value&&String(w.value[s.coursId]?.classeId)!==y.value||x.value&&String(s.coursId)!==x.value||h.value&&String(w.value[s.coursId]?.periodeId)!==h.value||k.value&&s.type!==k.value?!1:r?`${s.titre} ${s.type} ${s._coursLabel} ${s._matiere} ${s._classeLabel} ${s._profLabel} ${s._periodeLabel}`.toLowerCase().includes(r):!0)}),V=c(()=>u.items?.length||0),F=c(()=>u.loading||o.loading||t.loading||l.loading||m.loading),S=c(()=>u.error||o.error||t.error||l.error||m.error);async function M(r){confirm("Supprimer cette interro ?")&&(await u.removeOne(r),await u.fetch({_sort:"date",_order:"desc"}))}return(r,s)=>(n(),i("div",Be,[e("div",Te,[s[6]||(s[6]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Interrogations"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Gestion des interros par cours / classe / période ")],-1)),I(T(j),{to:"/interros/nouveau",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900"},{default:B(()=>[...s[5]||(s[5]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})],-1),b(" Nouvelle interro ",-1)])]),_:1})]),I(ie,{search:C.value,"onUpdate:search":s[0]||(s[0]=d=>C.value=d),classeId:y.value,"onUpdate:classeId":s[1]||(s[1]=d=>y.value=d),coursId:x.value,"onUpdate:coursId":s[2]||(s[2]=d=>x.value=d),periodeId:h.value,"onUpdate:periodeId":s[3]||(s[3]=d=>h.value=d),type:k.value,"onUpdate:type":s[4]||(s[4]=d=>k.value=d),"classes-options":E.value,"cours-options":N.value,"periodes-options":U.value,"types-options":R.value},null,8,["search","classeId","coursId","periodeId","type","classes-options","cours-options","periodes-options","types-options"]),e("div",je,[F.value?(n(),i("div",Ae,[...s[7]||(s[7]=[e("div",{class:"h-4 w-1/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-3"},null,-1),e("div",{class:"h-4 w-full animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-2"},null,-1),e("div",{class:"h-4 w-5/6 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):S.value?(n(),i("div",De,a(S.value),1)):L.value.length===0?(n(),i("div",Pe," Aucune interro trouvée. ")):(n(),i("div",Ee,[I(Oe,{items:L.value,total:V.value,onRemove:M},null,8,["items","total"])]))])]))}};export{Me as default};
