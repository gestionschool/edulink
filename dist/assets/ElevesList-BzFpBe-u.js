import{m as u,p as A,c as g,a as o,b as e,x as S,d as $,k as j,j as b,J as f,O as R,F as k,h,t as a,f as B,e as y,o as r,g as D,z as P}from"./index-BVVU7ImF.js";import{M as z}from"./Modal-sd0sgwys.js";import{u as F}from"./useStudents-D51OTvSI.js";import{u as H}from"./useClasses-6cjNtIyF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"space-y-6"},G={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},K={class:"flex flex-wrap gap-2"},Q={class:"grid gap-3 md:grid-cols-3"},W=["value"],X={class:"flex items-center gap-2"},Y={class:"text-xs text-slate-500 dark:text-slate-400"},Z={key:0,class:"rounded-xl border border-slate-200 p-4 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},ee={key:1,class:"rounded-xl border border-slate-200 p-4 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},te={key:2,class:"md:hidden divide-y divide-slate-100 dark:divide-slate-800 rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},se={class:"flex items-center justify-between"},le={class:"min-w-0"},oe={class:"truncate text-sm font-medium"},re={class:"text-xs text-slate-500 dark:text-slate-400"},ae={class:"shrink-0"},de=["onClick"],ie={key:3,class:"hidden md:block overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},ne={class:"overflow-x-auto"},ue={class:"min-w-full text-left text-sm"},be={class:"px-4 py-3"},ce={class:"px-4 py-3"},me={class:"px-4 py-3"},ve={class:"px-4 py-3"},pe={class:"flex justify-end gap-2"},xe=["onClick"],ge={class:"border-t border-slate-100 px-4 py-3 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},fe={class:"grid gap-3 md:grid-cols-2"},ke={class:"grid gap-3 md:grid-cols-2"},he=["value"],ye={key:0,class:"text-sm text-red-600 dark:text-red-400"},we=["disabled"],_e=["disabled"],Me={__name:"ElevesList",setup(Ce){const i=F(),w=H(),_=u(""),v=u(""),c=u(!1),p=u(!1),m=u(null),l=u({nom:"",matricule:"",classeId:"",photoUrl:""});A(async()=>{await Promise.all([w.fetch(),i.fetch()])});const I=g(()=>w.items||[]),E=g(()=>w.byId||{}),n=g(()=>{const d=_.value.trim().toLowerCase();return(i.items||[]).filter(t=>v.value&&Number(t.classeId)!==Number(v.value)?!1:d?`${t.nom||""} ${t.matricule||""}`.toLowerCase().includes(d):!0)}),O=g(()=>i.items?.length||0),C=d=>{const t=E.value[d];return t?t.libelle||t.label||t.code:"—"};async function L(){if(m.value=null,!l.value.nom||!l.value.classeId){m.value="Nom et classe sont obligatoires.";return}p.value=!0;try{await i.createOne({nom:l.value.nom,matricule:l.value.matricule||"",classeId:Number(l.value.classeId),photoUrl:l.value.photoUrl||""}),await i.fetch(),c.value=!1,l.value={nom:"",matricule:"",classeId:"",photoUrl:""}}catch(d){m.value=d?.message||"Erreur lors de la création"}finally{p.value=!1}}async function N(d){confirm("Supprimer cet élève ?")&&(await i.removeOne(d),await i.fetch())}function T(){window.print()}function q(){const d=["id","nom","matricule","classe"],t=n.value.map(x=>[x.id,`"${x.nom||""}"`,`"${x.matricule||""}"`,`"${C(x.classeId)}"`].join(",")),s=[d.join(","),...t].join(`
`),U=new Blob([s],{type:"text/csv;charset=utf-8;"}),M=URL.createObjectURL(U),V=document.createElement("a");V.href=M,V.download="eleves.csv",V.click(),URL.revokeObjectURL(M)}return(d,t)=>(r(),o("div",J,[e("div",G,[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Élèves"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Liste des élèves par classe. Recherche et export CSV. ")],-1)),e("div",K,[e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-medium shadow-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900",onClick:T}," Imprimer "),e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900",onClick:q}," Export CSV "),e("button",{type:"button",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900",onClick:t[0]||(t[0]=s=>c.value=!0)},[...t[9]||(t[9]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})],-1),j(" Nouvel élève ",-1)])])])]),e("div",Q,[b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),type:"search",placeholder:"Rechercher (nom, matricule)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[f,_.value]]),b(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[t[11]||(t[11]=e("option",{value:""},"Toutes classes",-1)),(r(!0),o(k,null,h(I.value,s=>(r(),o("option",{key:s.id,value:s.id},a(s.libelle||s.label||s.code),9,W))),128))],512),[[R,v.value,void 0,{number:!0}]]),e("div",X,[e("span",Y,"Total: "+a(n.value.length),1)])]),B(i).loading?(r(),o("div",Z," Chargement… ")):n.value.length===0?(r(),o("div",ee," Aucun élève trouvé. ")):(r(),o("div",te,[(r(!0),o(k,null,h(n.value,s=>(r(),o("div",{key:s.id,class:"p-3"},[e("div",se,[e("div",le,[e("div",oe,a(s.nom),1),e("div",re,a(s.matricule)+" — "+a(C(s.classeId)),1)]),e("div",ae,[e("button",{class:"rounded-md border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:U=>N(s.id)}," Supprimer ",8,de)])])]))),128))])),n.value.length?(r(),o("div",ie,[e("div",ne,[e("table",ue,[t[13]||(t[13]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Nom"),e("th",{class:"px-4 py-3 font-medium"},"Matricule"),e("th",{class:"px-4 py-3 font-medium"},"Classe"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(r(!0),o(k,null,h(n.value,s=>(r(),o("tr",{key:s.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",be,a(s.nom),1),e("td",ce,a(s.matricule),1),e("td",me,a(C(s.classeId)),1),e("td",ve,[e("div",pe,[$(B(D),{to:`/etudiants/detail?id=${s.id}`,class:"rounded-md border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:y(()=>[...t[12]||(t[12]=[j(" Détails ",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-md border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:U=>N(s.id)}," Supprimer ",8,xe)])])]))),128))])]),e("div",ge,a(n.value.length)+" / "+a(O.value)+" élément(s) ",1)])])):S("",!0),$(z,{modelValue:c.value,"onUpdate:modelValue":t[8]||(t[8]=s=>c.value=s)},{title:y(()=>[...t[14]||(t[14]=[e("h3",{class:"text-base font-semibold"},"Nouvel élève",-1)])]),actions:y(()=>[e("button",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900",onClick:t[7]||(t[7]=s=>c.value=!1),disabled:p.value},"Annuler",8,we),e("button",{class:"inline-flex items-center rounded-md border border-violet-200 bg-violet-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-violet-700 disabled:opacity-60 dark:border-violet-900",onClick:L,disabled:p.value},"Créer",8,_e)]),default:y(()=>[e("form",{class:"space-y-3",onSubmit:P(L,["prevent"])},[e("div",fe,[e("div",null,[t[15]||(t[15]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Nom complet",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.nom=s),type:"text",required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[f,l.value.nom]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Matricule",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.matricule=s),type:"text",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[f,l.value.matricule]])])]),e("div",ke,[e("div",null,[t[18]||(t[18]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Classe",-1)),b(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.classeId=s),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[t[17]||(t[17]=e("option",{value:""},"— Classe —",-1)),(r(!0),o(k,null,h(I.value,s=>(r(),o("option",{key:s.id,value:s.id},a(s.libelle||s.label||s.code),9,he))),128))],512),[[R,l.value.classeId,void 0,{number:!0}]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Photo (URL)",-1)),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.photoUrl=s),type:"url",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[f,l.value.photoUrl]])])]),m.value?(r(),o("p",ye,a(m.value),1)):S("",!0)],32)]),_:1},8,["modelValue"])]))}};export{Me as default};
