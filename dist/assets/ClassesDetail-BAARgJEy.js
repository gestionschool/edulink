import{m as v,l as se,w as le,p as oe,c as n,a,b as e,x as j,d as S,e as A,f as M,t as o,k as f,n as z,j as u,J as c,F as _,h as C,z as F,O as J,o as d,g as U}from"./index-BVVU7ImF.js";import{u as re}from"./useClasses-6cjNtIyF.js";import{u as ae}from"./useStudents-D51OTvSI.js";import{u as de}from"./useCours-WlUt9X8U.js";import{u as ie}from"./useTeachers-Cow4PRiH.js";import{u as ne}from"./usePeriodes-DPgYpSBx.js";const ue={class:"space-y-6"},ve={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},me={class:"min-w-0"},ce={class:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400"},pe={class:"truncate"},be={class:"mt-1 truncate text-xl font-semibold"},xe={class:"text-sm text-slate-500 dark:text-slate-400"},fe={class:"flex flex-wrap gap-2"},ke={class:"grid gap-3 sm:grid-cols-3"},ge={class:"rounded-xl border border-slate-200 p-4 dark:border-slate-800"},ye={class:"mt-1 text-2xl font-semibold"},he={class:"rounded-xl border border-slate-200 p-4 dark:border-slate-800"},we={class:"mt-1 text-2xl font-semibold"},_e={class:"rounded-xl border border-slate-200 p-4 dark:border-slate-800"},Ce={class:"mt-1 text-2xl font-semibold"},Ie={class:"flex flex-wrap items-center gap-2"},$e={key:0,class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},Ve={class:"flex items-center justify-between border-b border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},Ne={class:"text-slate-500 dark:text-slate-400"},je={key:0,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},Se={key:1,class:"overflow-x-auto"},Ae={class:"min-w-full text-left text-sm"},Me={class:"px-4 py-3"},Ue={class:"px-4 py-3 text-slate-500 dark:text-slate-400"},Le={class:"px-4 py-3"},Ee={class:"flex justify-end gap-2"},Re=["onClick"],Oe={key:1,class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},Pe={class:"flex items-center justify-between border-b border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},qe={class:"text-slate-500 dark:text-slate-400"},Be={key:0,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},De={key:1,class:"overflow-x-auto"},Te={class:"min-w-full text-left text-sm"},ze={class:"px-4 py-3"},Fe={class:"px-4 py-3"},Je={class:"px-4 py-3"},Ge={class:"px-4 py-3"},He={class:"px-4 py-3"},Ke={class:"flex justify-end gap-2"},Qe=["onClick"],We={key:2,class:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4"},Xe={class:"w-full max-w-lg rounded-2xl border border-slate-200 bg-white p-4 shadow-xl dark:border-slate-800 dark:bg-slate-900"},Ye={class:"grid gap-3 sm:grid-cols-2"},Ze={class:"flex justify-end gap-2 pt-2"},et={key:3,class:"fixed inset-0 z-50 grid place-items-center bg-black/40 p-4"},tt={class:"w-full max-w-2xl rounded-2xl border border-slate-200 bg-white p-4 shadow-xl dark:border-slate-800 dark:bg-slate-900"},st={class:"grid gap-3 sm:grid-cols-3"},lt={class:"grid gap-3 sm:grid-cols-3"},ot=["value"],rt=["value"],at={class:"flex justify-end gap-2 pt-2"},dt={key:4,class:"rounded-xl border border-slate-200 p-4 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},bt={__name:"ClassesDetail",setup(it){const L=se(),I=re(),b=ae(),x=de(),E=ie(),R=ne(),p=v(Number(L.query.id||0));le(()=>L.query.id,l=>{p.value=Number(l||0)});const O=v(!0);oe(async()=>{await Promise.all([I.fetch(),b.fetch(),x.fetch(),E.fetch(),R.fetch?.()]),O.value=!1});const i=n(()=>I.byId[p.value]||(I.items||[]).find(l=>l.id===p.value)||null),P=n(()=>i.value?i.value.libelle||i.value.label||i.value.code:""),k=n(()=>(b.items||[]).filter(l=>Number(l.classeId)===p.value)),g=n(()=>(x.items||[]).filter(l=>Number(l.classeId)===p.value)),q=n(()=>E.items||[]),$=n(()=>R.items||[]),G=n(()=>Object.fromEntries((q.value||[]).map(l=>[l.id,l]))),H=n(()=>Object.fromEntries(($.value||[]).map(l=>[l.id,l])));function K(l){const t=G.value[l];return t?t.prenom?`${t.prenom} ${t.nom}`:t.nom:"—"}function Q(l){return H.value[l]?.label||"—"}const W=n(()=>($.value||[]).find(l=>l.active)?.label||""),y=v("eleves"),V=v(""),N=v(""),B=n(()=>{const l=V.value.trim().toLowerCase();return l?k.value.filter(t=>`${t.nom} ${t.matricule||""}`.toLowerCase().includes(l)):k.value}),D=n(()=>{const l=N.value.trim().toLowerCase();return l?g.value.filter(t=>`${t.matiere||""} ${t.intitule||t.code||""}`.toLowerCase().includes(l)):g.value});async function X(l){confirm("Retirer cet élève de la classe ?")&&(await b.updateOne(l,{classeId:null}),await b.fetch())}async function Y(l){confirm("Supprimer ce cours ?")&&(await x.removeOne(l),await x.fetch())}const h=v(!1),m=v({nom:"",matricule:""});async function Z(){if(!m.value.nom.trim())return alert("Nom requis");const l={nom:m.value.nom.trim(),matricule:m.value.matricule.trim(),classeId:p.value,...i.value?.ecoleId?{ecoleId:i.value.ecoleId}:{}};await b.createOne(l),await b.fetch(),m.value={nom:"",matricule:""},h.value=!1}const w=v(!1),r=v({code:"",matiere:"",intitule:"",teacherId:"",periodeId:"",volume:0});async function ee(){if(!r.value.matiere||!r.value.teacherId||!r.value.periodeId)return alert("Matière, professeur et période sont requis.");const l={...r.value,classeId:p.value,volume:Number(r.value.volume||0),...i.value?.ecoleId?{ecoleId:i.value.ecoleId}:{}};await x.createOne(l),await x.fetch(),r.value={code:"",matiere:"",intitule:"",teacherId:"",periodeId:"",volume:0},w.value=!1}function T(l){return["rounded-md px-3 py-1.5 text-sm border",y.value===l?"border-violet-300 bg-violet-600 text-white dark:border-violet-800":"border-slate-200 bg-white text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-200"].join(" ")}return(l,t)=>(d(),a("div",ue,[e("div",ve,[e("div",me,[e("div",ce,[S(M(U),{to:"/classes",class:"hover:underline"},{default:A(()=>[...t[17]||(t[17]=[f("Classes",-1)])]),_:1}),t[18]||(t[18]=e("span",null,"/",-1)),e("span",pe,o(P.value||"Détail"),1)]),e("h1",be,o(P.value),1),e("p",xe,[t[19]||(t[19]=f(" Niveau : ",-1)),e("b",null,o(i.value?.niveau||"—"),1),t[20]||(t[20]=f(" · Filière : ",-1)),e("b",null,o(i.value?.filiere||"—"),1),t[21]||(t[21]=f(" · Titulaire : ",-1)),e("b",null,o(i.value?.titulaire||"—"),1)])]),e("div",fe,[e("button",{type:"button",class:"rounded-md border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900",onClick:t[0]||(t[0]=s=>l.window.print())}," Imprimer "),e("button",{type:"button",class:"rounded-md border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white hover:bg-violet-700 dark:border-violet-900",onClick:t[1]||(t[1]=s=>h.value=!0)}," + Élève "),e("button",{type:"button",class:"rounded-md border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white hover:bg-violet-700 dark:border-violet-900",onClick:t[2]||(t[2]=s=>w.value=!0)}," + Cours ")])]),e("div",ke,[e("div",ge,[t[22]||(t[22]=e("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"Effectif",-1)),e("div",ye,o(k.value.length),1)]),e("div",he,[t[23]||(t[23]=e("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"Cours",-1)),e("div",we,o(g.value.length),1)]),e("div",_e,[t[24]||(t[24]=e("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"Période active",-1)),e("div",Ce,o(W.value||"—"),1)])]),e("div",Ie,[e("button",{class:z(T("eleves")),onClick:t[3]||(t[3]=s=>y.value="eleves")},"Élèves",2),e("button",{class:z(T("cours")),onClick:t[4]||(t[4]=s=>y.value="cours")},"Cours",2)]),y.value==="eleves"?(d(),a("div",$e,[e("div",Ve,[u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>V.value=s),type:"search",placeholder:"Rechercher un élève (nom, matricule)…",class:"w-64 max-w-full rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[c,V.value]]),e("span",Ne,o(B.value.length)+" / "+o(k.value.length),1)]),k.value.length===0?(d(),a("div",je,"Aucun élève dans cette classe.")):(d(),a("div",Se,[e("table",Ae,[t[26]||(t[26]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Nom"),e("th",{class:"px-4 py-3 font-medium"},"Matricule"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(d(!0),a(_,null,C(B.value,s=>(d(),a("tr",{key:s.id,class:"border-t border-slate-100 dark:border-slate-800"},[e("td",Me,o(s.nom),1),e("td",Ue,o(s.matricule||"—"),1),e("td",Le,[e("div",Ee,[S(M(U),{to:`/communautes/etudiants/detail?id=${s.id}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:A(()=>[...t[25]||(t[25]=[f("Détails",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-lg border border-amber-200 px-2 py-1 text-xs text-amber-700 hover:bg-amber-50 dark:border-amber-900/40 dark:text-amber-300 dark:hover:bg-amber-900/10",onClick:te=>X(s.id)},"Retirer",8,Re)])])]))),128))])])]))])):(d(),a("div",Oe,[e("div",Pe,[u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>N.value=s),type:"search",placeholder:"Rechercher un cours (matière, intitule)…",class:"w-64 max-w-full rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[c,N.value]]),e("span",qe,o(D.value.length)+" / "+o(g.value.length),1)]),g.value.length===0?(d(),a("div",Be,"Aucun cours pour cette classe.")):(d(),a("div",De,[e("table",Te,[t[28]||(t[28]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Matière"),e("th",{class:"px-4 py-3 font-medium"},"Intitulé"),e("th",{class:"px-4 py-3 font-medium"},"Professeur"),e("th",{class:"px-4 py-3 font-medium"},"Période"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(d(!0),a(_,null,C(D.value,s=>(d(),a("tr",{key:s.id,class:"border-t border-slate-100 dark:border-slate-800"},[e("td",ze,o(s.matiere||"—"),1),e("td",Fe,o(s.intitule||s.code),1),e("td",Je,o(K(s.teacherId)),1),e("td",Ge,o(Q(s.periodeId)),1),e("td",He,[e("div",Ke,[S(M(U),{to:`/cours/detail?id=${s.id}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:A(()=>[...t[27]||(t[27]=[f("Détails",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:te=>Y(s.id)},"Supprimer",8,Qe)])])]))),128))])])]))])),h.value?(d(),a("div",We,[e("div",Xe,[t[30]||(t[30]=e("h3",{class:"mb-3 text-base font-semibold"},"Ajouter un élève",-1)),e("form",{class:"space-y-3",onSubmit:F(Z,["prevent"])},[e("div",Ye,[u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>m.value.nom=s),placeholder:"Nom complet",class:"input"},null,512),[[c,m.value.nom]]),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>m.value.matricule=s),placeholder:"Matricule",class:"input"},null,512),[[c,m.value.matricule]])]),e("div",Ze,[e("button",{type:"button",class:"btn",onClick:t[9]||(t[9]=s=>h.value=!1)},"Annuler"),t[29]||(t[29]=e("button",{type:"submit",class:"btn-primary"},"Créer",-1))])],32)])])):j("",!0),w.value?(d(),a("div",et,[e("div",tt,[t[34]||(t[34]=e("h3",{class:"mb-3 text-base font-semibold"},"Ajouter un cours",-1)),e("form",{class:"space-y-3",onSubmit:F(ee,["prevent"])},[e("div",st,[u(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>r.value.code=s),placeholder:"Code (ex: MAT101)",class:"input"},null,512),[[c,r.value.code]]),u(e("input",{"onUpdate:modelValue":t[11]||(t[11]=s=>r.value.matiere=s),placeholder:"Matière (ex: Math)",class:"input"},null,512),[[c,r.value.matiere]]),u(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>r.value.intitule=s),placeholder:"Intitulé",class:"input"},null,512),[[c,r.value.intitule]])]),e("div",lt,[u(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>r.value.teacherId=s),class:"input"},[t[31]||(t[31]=e("option",{value:""},"— Professeur —",-1)),(d(!0),a(_,null,C(q.value,s=>(d(),a("option",{key:s.id,value:s.id},o(s.prenom?s.prenom+" "+s.nom:s.nom),9,ot))),128))],512),[[J,r.value.teacherId,void 0,{number:!0}]]),u(e("select",{"onUpdate:modelValue":t[14]||(t[14]=s=>r.value.periodeId=s),class:"input"},[t[32]||(t[32]=e("option",{value:""},"— Période —",-1)),(d(!0),a(_,null,C($.value,s=>(d(),a("option",{key:s.id,value:s.id},o(s.label),9,rt))),128))],512),[[J,r.value.periodeId,void 0,{number:!0}]]),u(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>r.value.volume=s),type:"number",min:"0",placeholder:"Volume (h)",class:"input"},null,512),[[c,r.value.volume,void 0,{number:!0}]])]),e("div",at,[e("button",{type:"button",class:"btn",onClick:t[16]||(t[16]=s=>w.value=!1)},"Annuler"),t[33]||(t[33]=e("button",{type:"submit",class:"btn-primary"},"Créer",-1))])],32)])])):j("",!0),!O.value&&!i.value?(d(),a("div",dt," Classe introuvable. ")):j("",!0)]))}};export{bt as default};
