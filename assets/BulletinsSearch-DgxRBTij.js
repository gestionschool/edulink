import{m as c,p as I,c as g,a as l,b as t,j as f,O as w,F as h,h as k,f as y,J as V,t as o,o as a,d as C,e as L,k as j,g as B}from"./index-DNOX9g9Q.js";import{u as S}from"./useStudents-Bq4kq09d.js";import{u as M}from"./useClasses-DkAspZBe.js";import{u as N}from"./usePeriodes-CobyAUWM.js";const $={class:"space-y-6"},E={class:"grid gap-3 sm:grid-cols-3"},R=["value"],T=["value"],U={key:0,class:"rounded-2xl border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900"},A={key:1,class:"rounded-2xl border border-slate-200 bg-white p-6 text-sm text-red-600 dark:border-slate-800 dark:bg-slate-900 dark:text-red-400"},D={key:2,class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},F={key:0,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},O={key:1,class:"overflow-x-auto"},P={class:"min-w-full text-left text-sm"},q={class:"px-4 py-3"},z={class:"px-4 py-3"},J={class:"px-4 py-3"},G={class:"px-4 py-3"},H={class:"flex justify-end"},K={class:"flex items-center justify-between border-t border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},Q={class:"text-slate-500 dark:text-slate-400"},te={__name:"BulletinsSearch",setup(W){const b=S(),i=M(),d=N(),n=c(""),u=c(""),m=c(""),p=c(null);I(async()=>{try{await Promise.all([d.fetch(),i.fetch(),b.fetch()]);const r=(d.items||[]).find(e=>e.active);n.value=r?.id??d.items?.[0]?.id??""}catch(r){p.value=r?.message||"Erreur de chargement"}});const _=g(()=>b.loading||i.loading||d.loading),v=g(()=>Object.fromEntries((i.items||[]).map(r=>[r.id,r]))),x=g(()=>{const r=m.value.trim().toLowerCase();return(b.items||[]).filter(e=>u.value&&e.classeId!==Number(u.value)?!1:r?`${e.nom||""} ${e.matricule||""}`.toLowerCase().includes(r):!0).map(e=>({...e,classeLabel:v.value[e.classeId]?.libelle||v.value[e.classeId]?.label||v.value[e.classeId]?.code||"—"}))});return(r,e)=>(a(),l("div",$,[e[8]||(e[8]=t("div",{class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},[t("div",null,[t("h1",{class:"text-xl font-semibold"},"Recherche bulletin"),t("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Sélectionnez une période, une classe et un élève. ")])],-1)),t("div",E,[f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[e[3]||(e[3]=t("option",{disabled:"",value:""},"Choisir une période",-1)),(a(!0),l(h,null,k(y(d).items,s=>(a(),l("option",{key:s.id,value:s.id},o(s.label),9,R))),128))],512),[[w,n.value]]),f(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[e[4]||(e[4]=t("option",{value:""},"Toutes classes",-1)),(a(!0),l(h,null,k(y(i).items,s=>(a(),l("option",{key:s.id,value:s.id},o(s.libelle||s.label||s.code),9,T))),128))],512),[[w,u.value]]),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>m.value=s),type:"search",placeholder:"Rechercher un élève (nom, matricule)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[V,m.value]])]),_.value?(a(),l("div",U,[...e[5]||(e[5]=[t("div",{class:"h-4 w-1/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-3"},null,-1),t("div",{class:"h-4 w-full animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-2"},null,-1),t("div",{class:"h-4 w-5/6 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):p.value?(a(),l("div",A,o(p.value),1)):(a(),l("div",D,[x.value.length===0?(a(),l("div",F," Aucun élève trouvé. ")):(a(),l("div",O,[t("table",P,[e[7]||(e[7]=t("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[t("tr",null,[t("th",{class:"px-4 py-3 font-medium"},"Élève"),t("th",{class:"px-4 py-3 font-medium"},"Matricule"),t("th",{class:"px-4 py-3 font-medium"},"Classe"),t("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),t("tbody",null,[(a(!0),l(h,null,k(x.value,s=>(a(),l("tr",{key:s.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[t("td",q,o(s.nom),1),t("td",z,o(s.matricule||"—"),1),t("td",J,o(s.classeLabel),1),t("td",G,[t("div",H,[C(y(B),{to:`/bulletins/detail?eleveId=${s.id}&periodeId=${n.value}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:L(()=>[...e[6]||(e[6]=[j(" Voir le bulletin ",-1)])]),_:1},8,["to"])])])]))),128))])]),t("div",K,[t("span",Q,o(x.value.length)+" résultat(s) ",1)])]))]))]))}};export{te as default};
