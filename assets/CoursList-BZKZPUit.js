import{a as r,o as d,b as e,F as v,h as b,t as a,k as m,d as k,e as C,f as L,g as S,p as M,c as p,m as y}from"./index-DNOX9g9Q.js";import{u as R}from"./useCours-CvA8_x3u.js";import{u as U}from"./useClasses-DkAspZBe.js";import{u as F}from"./useTeachers-CqgeM82D.js";import{u as D}from"./usePeriodes-CobyAUWM.js";const q={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4"},z=["value"],H=["value"],G=["value"],J=["value"],K=["value"],Q=["value"],W=["value"],X={__name:"CoursFilters",props:{search:String,classeId:String,profId:String,periodeId:String,classesOptions:{type:Array,default:()=>[]},profsOptions:{type:Array,default:()=>[]},periodesOptions:{type:Array,default:()=>[]}},emits:["update:search","update:classeId","update:profId","update:periodeId"],setup(n){return(i,s)=>(d(),r("div",q,[e("input",{value:n.search,onInput:s[0]||(s[0]=t=>i.$emit("update:search",t.target.value)),type:"search",placeholder:"Rechercher (code, intitulé, prof, classe)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,40,z),e("select",{value:n.classeId,onChange:s[1]||(s[1]=t=>i.$emit("update:classeId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[s[4]||(s[4]=e("option",{value:""},"Toutes classes",-1)),(d(!0),r(v,null,b(n.classesOptions,t=>(d(),r("option",{key:t.value,value:t.value},a(t.label),9,G))),128))],40,H),e("select",{value:n.profId,onChange:s[2]||(s[2]=t=>i.$emit("update:profId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[s[5]||(s[5]=e("option",{value:""},"Tous professeurs",-1)),(d(!0),r(v,null,b(n.profsOptions,t=>(d(),r("option",{key:t.value,value:t.value},a(t.label),9,K))),128))],40,J),e("select",{value:n.periodeId,onChange:s[3]||(s[3]=t=>i.$emit("update:periodeId",t.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[s[6]||(s[6]=e("option",{value:""},"Toutes périodes",-1)),(d(!0),r(v,null,b(n.periodesOptions,t=>(d(),r("option",{key:t.value,value:t.value},a(t.label),9,W))),128))],40,Q)]))}},Y={class:"block md:hidden divide-y divide-slate-100 dark:divide-slate-800"},Z={class:"flex items-start justify-between gap-3"},ee={class:"min-w-0"},te={class:"font-semibold"},se={class:"text-xs text-slate-500 dark:text-slate-400"},oe=["onClick"],le={class:"mt-2 grid grid-cols-2 gap-2 text-xs text-slate-600 dark:text-slate-300"},ae={class:"hidden min-w-full text-left text-sm md:table"},re={class:"px-4 py-3"},de={class:"px-4 py-3"},ie={class:"px-4 py-3"},ne={class:"px-4 py-3"},ue={class:"px-4 py-3"},pe={class:"px-4 py-3"},ce={class:"px-4 py-3"},me={class:"px-4 py-3"},ve={class:"flex justify-end gap-2"},be=["onClick"],fe={class:"flex items-center justify-between border-t border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},ge={class:"text-slate-500 dark:text-slate-400"},xe={__name:"CoursTable",props:{items:{type:Array,default:()=>[]},total:{type:Number,default:0}},emits:["remove"],setup(n){return(i,s)=>(d(),r(v,null,[e("div",Y,[(d(!0),r(v,null,b(n.items,t=>(d(),r("div",{key:t.id,class:"p-4"},[e("div",Z,[e("div",ee,[e("div",te,a(t.intitule),1),e("div",se,a(t.code)+" • "+a(t.matiere||"—"),1)]),e("button",{class:"shrink-0 rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:c=>i.$emit("remove",t.id)},"Supprimer",8,oe)]),e("div",le,[e("div",null,[s[0]||(s[0]=e("span",{class:"opacity-60"},"Classe:",-1)),m(" "+a(t._classeLabel),1)]),e("div",null,[s[1]||(s[1]=e("span",{class:"opacity-60"},"Prof:",-1)),m(" "+a(t._profLabel),1)]),e("div",null,[s[2]||(s[2]=e("span",{class:"opacity-60"},"Période:",-1)),m(" "+a(t._periodeLabel),1)]),e("div",null,[s[3]||(s[3]=e("span",{class:"opacity-60"},"Volume:",-1)),m(" "+a(t.volume??0),1)])])]))),128))]),e("table",ae,[s[5]||(s[5]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Code"),e("th",{class:"px-4 py-3 font-medium"},"Intitulé"),e("th",{class:"px-4 py-3 font-medium"},"Matière"),e("th",{class:"px-4 py-3 font-medium"},"Classe"),e("th",{class:"px-4 py-3 font-medium"},"Professeur"),e("th",{class:"px-4 py-3 font-medium"},"Période"),e("th",{class:"px-4 py-3 font-medium"},"Volume"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(d(!0),r(v,null,b(n.items,t=>(d(),r("tr",{key:t.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",re,a(t.code),1),e("td",de,a(t.intitule),1),e("td",ie,a(t.matiere||"—"),1),e("td",ne,a(t._classeLabel),1),e("td",ue,a(t._profLabel),1),e("td",pe,a(t._periodeLabel),1),e("td",ce,a(t.volume??0),1),e("td",me,[e("div",ve,[k(L(S),{to:`/cours/detail?id=${t.id}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:C(()=>[...s[4]||(s[4]=[m(" Détails ",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:c=>i.$emit("remove",t.id)}," Supprimer ",8,be)])])]))),128))])]),e("div",fe,[e("span",ge,a(n.items.length)+" / "+a(n.total)+" éléments ",1)])],64))}},he={class:"space-y-6"},ye={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},ke={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},_e={key:0,class:"p-6"},$e={key:1,class:"p-6 text-sm text-red-600 dark:text-red-400"},we={key:2,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},Ie={key:3,class:"overflow-x-auto"},je={__name:"CoursList",setup(n){const i=R(),s=U(),t=F(),c=D();M(async()=>{await Promise.all([s.fetch(),t.fetch(),c.fetch(),i.fetch({_sort:"code"})])});const O=p(()=>Object.fromEntries((s.items||[]).map(l=>[l.id,l]))),P=p(()=>Object.fromEntries((t.items||[]).map(l=>[l.id,l]))),j=p(()=>Object.fromEntries((c.items||[]).map(l=>[l.id,l]))),_=y(""),f=y(""),g=y(""),x=y(""),B=p(()=>(s.items||[]).map(l=>({value:String(l.id),label:l.libelle||l.label||l.code}))),A=p(()=>(t.items||[]).map(l=>({value:String(l.id),label:l.nom||`${l.prenom??""} ${l.nom??""}`.trim()}))),T=p(()=>(c.items||[]).map(l=>({value:String(l.id),label:l.label}))),$=p(()=>{const l=_.value.trim().toLowerCase();return(i.items||[]).map(o=>{const u=O.value[o.classeId],h=P.value[o.teacherId],I=j.value[o.periodeId];return{...o,_classeLabel:u?u.libelle||u.label||u.code:"—",_profLabel:h?h.nom||`${h.prenom??""} ${h.nom??""}`.trim():"—",_periodeLabel:I?I.label:"—"}}).filter(o=>f.value&&String(o.classeId)!==f.value||g.value&&String(o.teacherId)!==g.value||x.value&&String(o.periodeId)!==x.value?!1:l?`${o.code} ${o.intitule} ${o.matiere} ${o._classeLabel} ${o._profLabel} ${o._periodeLabel}`.toLowerCase().includes(l):!0)}),V=p(()=>i.items?.length||0),N=p(()=>i.loading||s.loading||t.loading||c.loading),w=p(()=>i.error||s.error||t.error||c.error);async function E(l){confirm("Supprimer ce cours ?")&&(await i.removeOne(l),await i.fetch())}return(l,o)=>(d(),r("div",he,[e("div",ye,[o[5]||(o[5]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Cours / Matières"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Liaison classe ⇄ matière ⇄ professeur ⇄ période ")],-1)),k(L(S),{to:"/cours/nouveau",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900"},{default:C(()=>[...o[4]||(o[4]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})],-1),m(" Nouveau cours ",-1)])]),_:1})]),k(X,{search:_.value,"onUpdate:search":o[0]||(o[0]=u=>_.value=u),classeId:f.value,"onUpdate:classeId":o[1]||(o[1]=u=>f.value=u),profId:g.value,"onUpdate:profId":o[2]||(o[2]=u=>g.value=u),periodeId:x.value,"onUpdate:periodeId":o[3]||(o[3]=u=>x.value=u),"classes-options":B.value,"profs-options":A.value,"periodes-options":T.value},null,8,["search","classeId","profId","periodeId","classes-options","profs-options","periodes-options"]),e("div",ke,[N.value?(d(),r("div",_e,[...o[6]||(o[6]=[e("div",{class:"h-4 w-1/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-3"},null,-1),e("div",{class:"h-4 w-full animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-2"},null,-1),e("div",{class:"h-4 w-5/6 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):w.value?(d(),r("div",$e,a(w.value),1)):$.value.length===0?(d(),r("div",we," Aucun cours trouvé. ")):(d(),r("div",Ie,[k(xe,{items:$.value,total:V.value,onRemove:E},null,8,["items","total"])]))])]))}};export{je as default};
