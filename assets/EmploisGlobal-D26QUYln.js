import{m as b,p as H,w as E,c as w,a as r,b as l,d as B,j as u,O as f,F as k,h as g,e as C,o as d,t as o,z as K,x as O,J as j}from"./index-DNOX9g9Q.js";import{M as Q}from"./Modal-CesLprg6.js";import{u as R,_ as W}from"./useSeances-CXxdfBaT.js";import{u as X}from"./useClasses-DkAspZBe.js";import{u as Y}from"./useTeachers-CqgeM82D.js";import{u as Z}from"./useCours-CvA8_x3u.js";import{u as _}from"./usePeriodes-CobyAUWM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"space-y-6"},te={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},le={class:"flex flex-wrap gap-2"},se={class:"grid gap-3 md:grid-cols-3"},ae=["value"],re=["value"],de=["value"],oe={class:"text-base font-semibold"},ue={class:"grid gap-3 md:grid-cols-2"},ne=["value"],ie={class:"grid gap-3 md:grid-cols-2"},me={class:"grid gap-3 md:grid-cols-2"},be=["value"],ve=["value"],pe=["value"],xe={key:0,class:"text-sm text-red-600 dark:text-red-400"},ce=["disabled"],fe=["disabled"],ke=["disabled"],Ue={__name:"EmploisGlobal",setup(ge){const v=R(),S=X(),U=Y(),I=Z(),M=_?.(),i=b(""),m=b(""),N=b(""),p=b(!1),x=b(!1),c=b(null),n=b(null),P=["Lun","Mar","Mer","Jeu","Ven","Sam"],a=b({jour:1,start:"08:00",end:"09:00",classeId:"",coursId:"",teacherId:"",salle:""});H(async()=>{await Promise.all([S.fetch(),U.fetch(),I.fetch(),M?.fetch?.()]);try{await v.fetch()}catch(s){console.warn("[seances] manquant (dev) :",s?.message)}}),E(i,()=>{i.value&&(m.value="")}),E(m,()=>{m.value&&(i.value="")});const V=w(()=>S.items||[]),h=w(()=>U.items||[]),F=w(()=>M?.items||[]),$=w(()=>(I.items||[]).filter(s=>!a.value.classeId||Number(s.classeId)===Number(a.value.classeId))),D=w(()=>{let s=v.items||[];i.value&&(s=s.filter(e=>Number(e.classeId)===Number(i.value))),m.value&&(s=s.filter(e=>Number(e.teacherId)===Number(m.value)));const t=Object.fromEntries((I.items||[]).map(e=>[e.id,e]));return s.map(e=>({...e,...t[e.coursId]||{}}))});function J(){c.value=null,n.value=null,a.value={jour:1,start:"08:00",end:"09:00",classeId:i.value||(V.value[0]?.id??""),coursId:"",teacherId:m.value||(h.value[0]?.id??""),salle:""},p.value=!0}function A(s){c.value=null,n.value=s.id,a.value={jour:s.jour,start:s.start,end:s.end,classeId:s.classeId,coursId:s.coursId,teacherId:s.teacherId,salle:s.salle||""},p.value=!0}async function q(){c.value=null;const{jour:s,start:t,end:e,classeId:y,coursId:T,teacherId:z}=a.value;if(!s||!t||!e||!y||!T||!z){c.value="Champs requis manquants.";return}x.value=!0;try{n.value?await v.updateOne(n.value,a.value):await v.createOne(a.value),await v.fetch(),p.value=!1}catch(G){c.value=G?.message||"Erreur"}finally{x.value=!1}}async function L(){if(n.value&&confirm("Supprimer cette séance ?")){x.value=!0;try{await v.removeOne(n.value),await v.fetch(),p.value=!1}finally{x.value=!1}}}return(s,t)=>(d(),r("div",ee,[l("div",te,[t[14]||(t[14]=l("div",null,[l("h1",{class:"text-xl font-semibold"},"Emplois du temps"),l("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Vue hebdomadaire. Filtre par classe ou professeur. ")],-1)),l("div",le,[l("button",{class:"rounded-md border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900",onClick:t[0]||(t[0]=e=>s.window.print())},"Imprimer")])]),l("div",se,[u(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[t[15]||(t[15]=l("option",{value:""},"— Classe —",-1)),(d(!0),r(k,null,g(V.value,e=>(d(),r("option",{key:e.id,value:e.id},o(e.libelle||e.label||e.code),9,ae))),128))],512),[[f,i.value,void 0,{number:!0}]]),u(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>m.value=e),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[t[16]||(t[16]=l("option",{value:""},"— Professeur —",-1)),(d(!0),r(k,null,g(h.value,e=>(d(),r("option",{key:e.id,value:e.id},o(e.prenom?e.prenom+" "+e.nom:e.nom),9,re))),128))],512),[[f,m.value,void 0,{number:!0}]]),u(l("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>N.value=e),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[t[17]||(t[17]=l("option",{value:""},"— Période —",-1)),(d(!0),r(k,null,g(F.value,e=>(d(),r("option",{key:e.id,value:e.id},o(e.label),9,de))),128))],512),[[f,N.value,void 0,{number:!0}]])]),B(W,{sessions:D.value,onCreate:t[4]||(t[4]=e=>J()),onEdit:A},null,8,["sessions"]),B(Q,{modelValue:p.value,"onUpdate:modelValue":t[13]||(t[13]=e=>p.value=e)},{title:C(()=>[l("h3",oe,o(n.value?"Modifier la séance":"Ajouter une séance"),1)]),actions:C(()=>[l("button",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900",onClick:t[12]||(t[12]=e=>p.value=!1),disabled:x.value},"Annuler",8,ce),l("button",{class:"inline-flex items-center rounded-md border border-violet-200 bg-violet-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-violet-700 disabled:opacity-60 dark:border-violet-900",onClick:q,disabled:x.value},o(n.value?"Mettre à jour":"Créer"),9,fe),n.value?(d(),r("button",{key:0,class:"ml-auto inline-flex items-center rounded-md border border-red-200 px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:L,disabled:x.value},"Supprimer",8,ke)):O("",!0)]),default:C(()=>[l("form",{class:"space-y-3",onSubmit:K(q,["prevent"])},[l("div",ue,[l("div",null,[t[18]||(t[18]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Jour",-1)),u(l("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>a.value.jour=e),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(d(),r(k,null,g(P,(e,y)=>l("option",{key:y,value:y+1},o(e),9,ne)),64))],512),[[f,a.value.jour,void 0,{number:!0}]])]),l("div",null,[t[19]||(t[19]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Salle",-1)),u(l("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>a.value.salle=e),type:"text",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[j,a.value.salle]])])]),l("div",ie,[l("div",null,[t[20]||(t[20]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Début",-1)),u(l("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>a.value.start=e),type:"time",required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[j,a.value.start]])]),l("div",null,[t[21]||(t[21]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Fin",-1)),u(l("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>a.value.end=e),type:"time",required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[j,a.value.end]])])]),l("div",me,[l("div",null,[t[22]||(t[22]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Classe",-1)),u(l("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>a.value.classeId=e),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(d(!0),r(k,null,g(V.value,e=>(d(),r("option",{key:e.id,value:e.id},o(e.libelle||e.label||e.code),9,be))),128))],512),[[f,a.value.classeId,void 0,{number:!0}]])]),l("div",null,[t[23]||(t[23]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Cours",-1)),u(l("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>a.value.coursId=e),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(d(!0),r(k,null,g($.value,e=>(d(),r("option",{key:e.id,value:e.id},o(e.matiere)+" — "+o(e.intitule||e.code),9,ve))),128))],512),[[f,a.value.coursId,void 0,{number:!0}]])])]),l("div",null,[t[24]||(t[24]=l("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Professeur",-1)),u(l("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>a.value.teacherId=e),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(d(!0),r(k,null,g(h.value,e=>(d(),r("option",{key:e.id,value:e.id},o(e.prenom?e.prenom+" "+e.nom:e.nom),9,pe))),128))],512),[[f,a.value.teacherId,void 0,{number:!0}]])]),c.value?(d(),r("p",xe,o(c.value),1)):O("",!0)],32)]),_:1},8,["modelValue"])]))}};export{Ue as default};
