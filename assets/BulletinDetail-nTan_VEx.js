import{f as r,z as O,g as T,o as a,h as V,u as E,a as e,c as u,d as B,F as m,t as n,n as U,j as F}from"./index-sHYk9eTQ.js";import{A as q}from"./AppLayout-BRMBkRdv.js";import{u as H}from"./school-D6Cy93US.js";const J={class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors"},K={class:"mx-auto max-w-6xl p-4 sm:p-6"},Q={id:"printable",class:"p-6 max-w-6xl mx-auto"},W={key:0,class:"rounded-xl border p-6 text-sm text-zinc-600 dark:text-zinc-300"},X={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6"},Z={class:"text-2xl font-semibold"},ee={class:"text-sm text-zinc-600 dark:text-zinc-400"},te={class:"grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 mb-6"},se=["src"],oe={class:"rounded-2xl border border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 p-4"},ne={class:"grid sm:grid-cols-2 gap-3 text-sm"},re={class:"font-medium"},le={class:"font-medium"},ie={class:"font-medium"},de={class:"font-medium"},ae={class:"rounded-2xl border border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 overflow-hidden"},ce={class:"w-full text-sm"},ue={class:"px-4 py-3 font-medium"},ve={class:"px-4 py-3"},xe={class:"flex flex-wrap gap-2"},pe={class:"text-xs uppercase tracking-wide"},be={class:"text-xs"},me={class:"text-xs font-semibold"},fe={class:"px-4 py-3 font-semibold"},ge={class:"px-4 py-3 text-zinc-600 dark:text-zinc-400"},_e={class:"border-t border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 bg-zinc-50/60 dark:bg-zinc-900/40"},he={class:"px-4 py-3 font-bold text-lg"},ke={class:"mt-6 grid sm:grid-cols-3 gap-4"},ze={class:"rounded-2xl border border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 p-4"},ye={class:"text-2xl font-semibold"},we={class:"rounded-2xl border border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 p-4"},Be={class:"text-2xl font-semibold"},Fe={class:"rounded-2xl border border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 p-4"},De={class:"text-sm"},$e='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect width="200" height="200" fill="%23e5e7eb"/><circle cx="100" cy="80" r="40" fill="%239ca3af"/><rect x="40" y="130" width="120" height="50" rx="25" fill="%239ca3af"/></svg>',je={__name:"BulletinDetail",setup(Ie){const f=O(),g=E(),D=H(),$=r(()=>Number(f.params.eleveId)),I=r(()=>Number(f.params.periodeId)),c=r(()=>D.getBulletin($.value,I.value)),v=r(()=>c.value?.eleve||null),x=r(()=>c.value?.classe||null),_=r(()=>c.value?.periode||null),M=r(()=>c.value?.evaluations||[]),N=r(()=>c.value?.observationsGenerales||""),h=r(()=>c.value?.rank??null),C=r(()=>!v.value||!x.value||!_.value),j=new Date().getMonth()+1>=9?`${new Date().getFullYear()}-${new Date().getFullYear()+1}`:`${new Date().getFullYear()-1}-${new Date().getFullYear()}`,p=r(()=>R(M.value)),k=r(()=>{if(!p.value.length)return null;const o=p.value.map(s=>s.moyenne).filter(s=>typeof s=="number");if(!o.length)return null;const t=o.reduce((s,l)=>s+l,0)/o.length;return z(t,1)}),A=r(()=>Y(k.value)),P=r(()=>h.value?`${h.value}ᵉ`:"—");function R(o){const t={};for(const s of o)t[s.matiere]||(t[s.matiere]=[]),t[s.matiere].push(s);return Object.keys(t).map(s=>{const l=t[s],y=l.reduce((i,d)=>i+(d.coef||0),0),L=l.reduce((i,d)=>i+(isFinite(d.note)?d.note*(d.coef||0):0),0),w=y?L/y:null;return{matiere:s,evaluations:l.map((i,d)=>({...i,__key:`${s}-${i.type}-${i.coef}-${d}`})),moyenne:w!=null?z(w,1):null,observations:l.map(i=>i.obs).filter(Boolean).join(" • ")}})}function z(o,t=1){if(!isFinite(o))return null;const s=Math.pow(10,t);return Math.round(o*s)/s}function b(o){return o==null?"—":`${Number(o).toFixed(1)}/20`}function Y(o){return o==null?"—":o>=16?"Très bien":o>=14?"Bien":o>=12?"Assez bien":o>=10?"Passable":"Insuffisant"}function S(){window.history.length>1?g.back():g.push({name:"etudiants"})}function G(){window.print()}return(o,t)=>(a(),T(q,null,{default:V(()=>[e("div",J,[e("div",K,[e("section",Q,[C.value?(a(),u("div",W,[...t[0]||(t[0]=[B(" Bulletin introuvable. Vérifie l’URL (",-1),e("code",null,"/bulletin/:eleveId/:periodeId",-1),B("). ",-1)])])):(a(),u(m,{key:1},[e("div",X,[e("div",null,[e("h1",Z," Fiche de cote — "+n(v.value?.nom??"Élève"),1),e("p",ee," Période : "+n(_.value?.label??"—")+" • Classe : "+n(x.value?.label??"—"),1)]),e("div",{class:"no-print flex gap-2"},[e("button",{onClick:S,class:"px-3 py-2 rounded-xl border dark:border-zinc-700"}," ← Retour "),e("button",{onClick:G,class:"px-3 py-2 rounded-xl border dark:border-zinc-700"}," Imprimer ")])]),e("div",te,[e("img",{src:v.value?.photoUrl||$e,alt:"Photo élève",class:"w-28 h-28 rounded-xl object-cover bg-zinc-200 dark:bg-zinc-800"},null,8,se),e("div",oe,[e("div",ne,[e("div",null,[t[1]||(t[1]=e("div",{class:"text-zinc-500 dark:text-zinc-400"},"Nom complet",-1)),e("div",re,n(v.value?.nom??"—"),1)]),e("div",null,[t[2]||(t[2]=e("div",{class:"text-zinc-500 dark:text-zinc-400"},"Matricule",-1)),e("div",le,n(v.value?.matricule??"—"),1)]),e("div",null,[t[3]||(t[3]=e("div",{class:"text-zinc-500 dark:text-zinc-400"},"Classe",-1)),e("div",ie,n(x.value?.label??"—"),1)]),e("div",null,[t[4]||(t[4]=e("div",{class:"text-zinc-500 dark:text-zinc-400"},"Année scolaire",-1)),e("div",de,n(U(j)),1)])])])]),e("div",ae,[e("table",ce,[t[7]||(t[7]=e("thead",{class:"bg-zinc-50 dark:bg-zinc-900/50"},[e("tr",{class:"text-left"},[e("th",{class:"px-4 py-3"},"Matière"),e("th",{class:"px-4 py-3"},"Évaluations (D/Int/Exam)"),e("th",{class:"px-4 py-3"},"Moy. matière"),e("th",{class:"px-4 py-3"},"Observations")])],-1)),e("tbody",null,[(a(!0),u(m,null,F(p.value,s=>(a(),u("tr",{key:s.matiere,class:"border-t border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800 align-top"},[e("td",ue,n(s.matiere),1),e("td",ve,[e("div",xe,[(a(!0),u(m,null,F(s.evaluations,l=>(a(),u("span",{key:l.__key,class:"inline-flex items-center gap-1 px-2 py-1 rounded-lg border border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800"},[e("span",pe,n(l.type),1),e("span",be,"Coef "+n(l.coef),1),e("span",me,n(b(l.note)),1)]))),128))])]),e("td",fe,n(b(s.moyenne)),1),e("td",ge,n(s.observations||"—"),1)]))),128))]),e("tfoot",null,[e("tr",_e,[t[5]||(t[5]=e("td",{class:"px-4 py-3 font-semibold",colspan:"2"},"Moyenne générale",-1)),e("td",he,n(b(k.value)),1),t[6]||(t[6]=e("td",{class:"px-4 py-3"},null,-1))])])])]),e("div",ke,[e("div",ze,[t[8]||(t[8]=e("div",{class:"text-zinc-500 dark:text-zinc-400 text-sm"},"Rang",-1)),e("div",ye,n(P.value),1)]),e("div",we,[t[9]||(t[9]=e("div",{class:"text-zinc-500 dark:text-zinc-400 text-sm"},"Mention",-1)),e("div",Be,n(A.value),1)]),e("div",Fe,[t[10]||(t[10]=e("div",{class:"text-zinc-500 dark:text-zinc-400 text-sm"},"Observations générales",-1)),e("div",De,n(N.value||"—"),1)])]),t[11]||(t[11]=e("div",{class:"mt-10 grid sm:grid-cols-2 gap-6"},[e("div",null,[e("div",{class:"text-sm text-zinc-500 dark:text-zinc-400"},"Professeur principal"),e("div",{class:"h-20 mt-6 rounded-xl border border-dashed border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800"})]),e("div",null,[e("div",{class:"text-sm text-zinc-500 dark:text-zinc-400"},"Direction"),e("div",{class:"h-20 mt-6 rounded-xl border border-dashed border-[var(--grid-line-color,#e5e7eb)] dark:border-zinc-800"})])],-1))],64))])])])]),_:1}))}};export{je as default};
