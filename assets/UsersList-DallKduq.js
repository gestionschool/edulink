import{N as H,m as u,p as J,R as i,c as f,a as r,b as e,d as K,k as D,j as c,J as B,O as g,F as b,h as m,f as k,t as a,e as M,o,x as w,n as Q,z as W}from"./index-DNOX9g9Q.js";import{M as X}from"./Modal-CesLprg6.js";import{u as Y}from"./useTeachers-CqgeM82D.js";import{u as Z}from"./useEcoles-BDZ5z8Ve.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"space-y-6"},te={class:"grid gap-3 md:grid-cols-3"},le=["value"],se=["value"],re={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},oe={key:0,class:"p-6 space-y-2"},ae={key:1,class:"p-6 text-sm text-red-600 dark:text-red-400"},de={key:2},ne={class:"md:hidden divide-y divide-slate-100 dark:divide-slate-800"},ie={class:"flex items-center justify-between"},ue={class:"min-w-0"},ce={class:"truncate font-medium"},be={class:"mt-0.5 text-xs text-slate-500 dark:text-slate-400"},me={key:0},ve={key:1},pe={class:"shrink-0 flex gap-2"},xe=["onClick"],fe=["onClick"],ge={class:"hidden md:block overflow-x-auto"},ke={class:"min-w-full text-left text-sm"},he={class:"px-4 py-3"},ye={class:"px-4 py-3"},_e={class:"px-4 py-3"},we={class:"px-4 py-3"},Ie={class:"px-4 py-3"},Ee={class:"flex justify-end gap-2"},Ce=["onClick"],Ne=["onClick"],Se={class:"flex items-center justify-between border-t border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},Me={class:"text-slate-500 dark:text-slate-400"},Ae={class:"text-base font-semibold"},Oe={class:"grid gap-3 md:grid-cols-2"},Re={class:"md:col-span-2"},Ue=["value"],Ve=["value"],Le={key:0,class:"md:col-span-2"},$e=["value"],Pe={key:0,class:"text-sm text-red-600 dark:text-red-400"},je=["disabled"],De=["disabled"],He={__name:"UsersList",setup(Be){const d=H(),A=Y(),O=Z(),I=u(""),h=u(""),y=u(""),v=u(!1),_=u(!1),p=u(null),x=u(null),n=u({name:"",role:"",ecoleId:"",teacherId:""});J(async()=>{await Promise.all([d.fetch(),A.fetch(),O.fetch?.()])});const E=[{value:i.ADMIN_GENERALE,label:"Admin général"},{value:i.ADMIN_ECOLE,label:"Admin école"},{value:i.PROFESSEUR,label:"Professeur"}],R=f(()=>A.items||[]),C=f(()=>O.items||[]),F=f(()=>Object.fromEntries(R.value.map(s=>[s.id,s]))),T=f(()=>Object.fromEntries(C.value.map(s=>[s.id,s])));function U(s){const t=F.value[s];return t?t.prenom?`${t.prenom} ${t.nom}`:t.nom:""}function V(s){return T.value[s]?.nom||""}const N=f(()=>{const s=I.value.trim().toLowerCase();return(d.items||[]).filter(t=>h.value&&t.role!==h.value||y.value&&Number(t.ecoleId)!==Number(y.value)?!1:s?(t.name||"").toLowerCase().includes(s):!0)}),q=f(()=>d.items?.length||0);function L(s){const t=E.find(l=>l.value===s);return t?t.label:s||"—"}function z(s){const t="px-2 py-0.5 border";switch(s){case i.ADMIN_GENERALE:return`${t} border-indigo-200 bg-indigo-50 text-indigo-700 dark:border-indigo-900/40 dark:bg-indigo-900/30 dark:text-indigo-200`;case i.ADMIN_ECOLE:return`${t} border-emerald-200 bg-emerald-50 text-emerald-700 dark:border-emerald-900/40 dark:bg-emerald-900/30 dark:text-emerald-200`;case i.PROFESSEUR:return`${t} border-amber-200 bg-amber-50 text-amber-700 dark:border-amber-900/40 dark:bg-amber-900/30 dark:text-amber-200`;default:return`${t} border-slate-200 bg-slate-50 text-slate-700 dark:border-slate-800 dark:bg-slate-800/40 dark:text-slate-200`}}function G(){x.value=null,p.value=null,n.value={name:"",role:i.ADMIN_ECOLE,ecoleId:"",teacherId:""},v.value=!0}function $(s){x.value=s.id,p.value=null,n.value={name:s.name||"",role:s.role||"",ecoleId:s.ecoleId||"",teacherId:s.teacherId||""},v.value=!0}async function P(){p.value=null,_.value=!0;try{const s={...n.value};s.role!==i.PROFESSEUR&&(s.teacherId=void 0),s.ecoleId||(s.ecoleId=void 0),x.value?await d.updateOne(x.value,s):await d.createOne(s),await d.fetch(),v.value=!1}catch(s){p.value=s?.message||"Erreur"}finally{_.value=!1}}async function j(s){confirm("Supprimer cet utilisateur ?")&&(await d.removeOne(s),await d.fetch())}return(s,t)=>(o(),r("div",ee,[e("div",{class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Utilisateurs"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Comptes de la plateforme (Admin général, Admin école, Professeur). ")],-1)),e("div",{class:"flex flex-wrap gap-2"},[e("button",{class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900",onClick:G},[...t[9]||(t[9]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})],-1),D(" Nouvel utilisateur ",-1)])])])]),e("div",te,[c(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>I.value=l),type:"search",placeholder:"Rechercher (nom)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[B,I.value]]),c(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[t[11]||(t[11]=e("option",{value:""},"Tous rôles",-1)),(o(),r(b,null,m(E,l=>e("option",{key:l.value,value:l.value},a(l.label),9,le)),64))],512),[[g,h.value]]),c(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>y.value=l),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[t[12]||(t[12]=e("option",{value:""},"Toutes écoles",-1)),(o(!0),r(b,null,m(C.value,l=>(o(),r("option",{key:l.id,value:l.id},a(l.nom),9,se))),128))],512),[[g,y.value,void 0,{number:!0}]])]),e("div",re,[k(d).loading?(o(),r("div",oe,[...t[13]||(t[13]=[e("div",{class:"h-4 w-1/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1),e("div",{class:"h-4 w-2/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):k(d).error?(o(),r("div",ae,a(k(d).error?.message||k(d).error),1)):(o(),r("div",de,[e("div",ne,[(o(!0),r(b,null,m(N.value,l=>(o(),r("div",{key:l.id,class:"p-3"},[e("div",ie,[e("div",ue,[e("div",ce,a(l.name),1),e("div",be,[D(a(L(l.role))+" ",1),l.ecoleId?(o(),r("span",me,"· "+a(V(l.ecoleId)),1)):w("",!0),l.teacherId?(o(),r("span",ve,"· Prof: "+a(U(l.teacherId)),1)):w("",!0)])]),e("div",pe,[e("button",{class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800",onClick:S=>$(l)},"Modifier",8,xe),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:S=>j(l.id)},"Supprimer",8,fe)])])]))),128))]),e("div",ge,[e("table",ke,[t[14]||(t[14]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Nom"),e("th",{class:"px-4 py-3 font-medium"},"Rôle"),e("th",{class:"px-4 py-3 font-medium"},"École"),e("th",{class:"px-4 py-3 font-medium"},"Professeur lié"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(o(!0),r(b,null,m(N.value,l=>(o(),r("tr",{key:l.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",he,a(l.name),1),e("td",ye,[e("span",{class:Q(["inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium",z(l.role)])},a(L(l.role)),3)]),e("td",_e,a(V(l.ecoleId)||"—"),1),e("td",we,a(U(l.teacherId)||"—"),1),e("td",Ie,[e("div",Ee,[e("button",{class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800",onClick:S=>$(l)},"Modifier",8,Ce),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:S=>j(l.id)},"Supprimer",8,Ne)])])]))),128))])]),e("div",Se,[e("span",Me,a(N.value.length)+" / "+a(q.value)+" éléments ",1)])])]))]),K(X,{modelValue:v.value,"onUpdate:modelValue":t[8]||(t[8]=l=>v.value=l)},{title:M(()=>[e("h3",Ae,a(x.value?"Modifier l’utilisateur":"Nouvel utilisateur"),1)]),actions:M(()=>[e("button",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900",onClick:t[7]||(t[7]=l=>v.value=!1),disabled:_.value},"Annuler",8,je),e("button",{class:"inline-flex items-center rounded-md border border-violet-200 bg-violet-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-violet-700 disabled:opacity-60 dark:border-violet-900",onClick:P,disabled:_.value},a(x.value?"Mettre à jour":"Créer"),9,De)]),default:M(()=>[e("form",{class:"space-y-3",onSubmit:W(P,["prevent"])},[e("div",Oe,[e("div",Re,[t[15]||(t[15]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Nom",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.name=l),type:"text",required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},null,512),[[B,n.value.name]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Rôle",-1)),c(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.role=l),required:"",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[(o(),r(b,null,m(E,l=>e("option",{key:l.value,value:l.value},a(l.label),9,Ue)),64))],512),[[g,n.value.role]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"École",-1)),c(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.ecoleId=l),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[t[17]||(t[17]=e("option",{value:""},"— Aucune —",-1)),(o(!0),r(b,null,m(C.value,l=>(o(),r("option",{key:l.id,value:l.id},a(l.nom),9,Ve))),128))],512),[[g,n.value.ecoleId,void 0,{number:!0}]])]),n.value.role===k(i).PROFESSEUR?(o(),r("div",Le,[t[20]||(t[20]=e("label",{class:"mb-1 block text-xs text-slate-500 dark:text-slate-400"},"Lier à un professeur (optionnel)",-1)),c(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.teacherId=l),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm dark:border-slate-800 dark:bg-slate-900"},[t[19]||(t[19]=e("option",{value:""},"— Aucun —",-1)),(o(!0),r(b,null,m(R.value,l=>(o(),r("option",{key:l.id,value:l.id},a(l.prenom?l.prenom+" "+l.nom:l.nom),9,$e))),128))],512),[[g,n.value.teacherId,void 0,{number:!0}]])])):w("",!0)]),p.value?(o(),r("p",Pe,a(p.value),1)):w("",!0)],32)]),_:1},8,["modelValue"])]))}};export{He as default};
