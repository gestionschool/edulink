import{m as _,l as Y,w as U,p as Z,c as d,a as r,b as e,x as $,d as j,e as k,f as y,t as a,k as v,F as p,i as ee,j as G,O as te,h as g,J as se,o,g as w}from"./index-DNOX9g9Q.js";import{u as le}from"./useStudents-Bq4kq09d.js";import{u as ae}from"./useClasses-DkAspZBe.js";import{u as oe}from"./useCours-CvA8_x3u.js";import{u as re}from"./usePeriodes-CobyAUWM.js";import{u as de}from"./useEvaluations-Bo1UKVNf.js";import{u as ie}from"./useTeachers-CqgeM82D.js";import{u as ne}from"./useBulletinsMeta-BkKco9FQ.js";const ue={class:"space-y-6"},ce={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},me={class:"min-w-0"},ve={class:"flex items-center gap-2 text-sm text-slate-500 dark:text-slate-400"},be={class:"truncate"},xe={class:"mt-1 truncate text-xl font-semibold"},pe={class:"text-sm text-slate-500 dark:text-slate-400"},fe={class:"flex flex-wrap gap-2"},he={class:"grid gap-3 sm:grid-cols-3"},_e={class:"rounded-xl border border-slate-200 p-4 dark:border-slate-800"},ke={class:"mt-1 text-2xl font-semibold"},ye={class:"rounded-xl border border-slate-200 p-4 dark:border-slate-800"},ge={class:"mt-1 text-2xl font-semibold"},we={class:"rounded-xl border border-slate-200 p-4 dark:border-slate-800"},Ne={class:"mt-1 text-2xl font-semibold"},Ie={class:"flex flex-wrap items-center gap-2"},Me=["value"],Ce={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},Se={class:"border-b border-slate-100 px-4 py-3 text-sm font-medium dark:border-slate-800"},$e={key:0,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},je={key:1,class:"overflow-x-auto"},Ee={class:"min-w-full text-left text-sm"},Be={class:"px-4 py-3"},Oe={class:"px-4 py-3 font-medium"},Ve={class:"px-4 py-3 text-slate-500 dark:text-slate-400"},Le={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},De={class:"flex items-center justify-between border-b border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},Pe={class:"font-medium"},Re={key:0,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},Ae={key:1,class:"overflow-x-auto"},Fe={class:"min-w-full text-left text-sm"},Te={class:"px-4 py-3"},qe={class:"px-4 py-3"},Ue={class:"px-4 py-3"},Ge={class:"px-4 py-3 font-medium"},Je={class:"px-4 py-3 text-slate-500 dark:text-slate-400"},We={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},ze={class:"border-b border-slate-100 px-4 py-3 text-sm font-medium dark:border-slate-800"},He={key:0,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},Ke={key:1,class:"divide-y divide-slate-100 dark:divide-slate-800"},Qe={class:"min-w-0"},Xe={class:"truncate font-medium"},Ye={class:"text-xs text-slate-500 dark:text-slate-400"},Ze={key:0,class:"rounded-xl border border-slate-200 p-4 text-sm text-slate-500 dark:border-slate-800 dark:text-slate-400"},nt={__name:"ElevesDetail",setup(et){const E=Y(),c=_(Number(E.query.id||0));U(()=>E.query.id,s=>{c.value=Number(s||0)});const N=le(),I=ae(),M=oe(),B=re(),O=de(),V=ie(),L=ne?.(),D=_(!0);Z(async()=>{await Promise.all([N.fetch(),I.fetch(),M.fetch(),B.fetch?.(),O.fetch?.(),V.fetch?.(),L?.fetch?.()]),D.value=!1});const m=d(()=>N.byId?.[c.value]||(N.items||[]).find(s=>s.id===c.value)||null),P=d(()=>m.value?.nom||"—"),i=d(()=>m.value&&(I.byId?.[m.value.classeId]||(I.items||[]).find(s=>s.id===m.value.classeId))||null),R=d(()=>i.value?i.value.libelle||i.value.label||i.value.code:""),f=d(()=>B.items||[]),b=d(()=>(f.value||[]).find(s=>s.active)||null),u=_(b.value?.id||f.value?.[0]?.id||null);U(b,s=>{!u.value&&s&&(u.value=s.id)});const A=d(()=>i.value?(M.items||[]).filter(s=>Number(s.classeId)===Number(i.value.id)):[]),J=d(()=>(O.items||[]).filter(s=>Number(s.eleveId)===c.value)),x=d(()=>J.value.filter(s=>Number(s.periodeId)===Number(u.value))),W=d(()=>Object.fromEntries((M.items||[]).map(s=>[s.id,s]))),z=d(()=>Object.fromEntries((V.items||[]).map(s=>[s.id,s])));function H(s){const t=z.value[s];return t?t.prenom?`${t.prenom} ${t.nom}`:t.nom:"—"}function F(s){return(f.value||[]).find(l=>l.id===s)?.label||"—"}const C=d(()=>x.value.map(s=>{const t=s.coursId?W.value[s.coursId]:null;return{...s,_matiere:t?.matiere||s.matiere||"—"}}));function T(s){const t=s.reduce((n,h)=>n+Number(h.note)*Number(h.coef||1),0),l=s.reduce((n,h)=>n+Number(h.coef||1),0);return l?Math.round(t/l*100)/100:null}const K=d(()=>T(x.value)),q=d(()=>{const s={};return C.value.forEach(t=>{const l=t._matiere||"—";s[l]||(s[l]={items:[]}),s[l].items.push(t)}),Object.fromEntries(Object.entries(s).map(([t,l])=>{const n=T(l.items);return[t,{moy:n,count:l.items.length}]}))}),Q=d(()=>(L?.items||[]).find(l=>Number(l.eleveId)===c.value&&Number(l.periodeId)===Number(u.value))?.rank??null),S=_(""),X=d(()=>{const s=S.value.trim().toLowerCase();return s?C.value.filter(t=>`${t._matiere} ${t.type} ${t.obs||""}`.toLowerCase().includes(s)):C.value});return(s,t)=>(o(),r("div",ue,[e("div",ce,[e("div",me,[e("div",ve,[j(y(w),{to:"/communautes/etudiants",class:"hover:underline"},{default:k(()=>[...t[3]||(t[3]=[v("Élèves",-1)])]),_:1}),t[4]||(t[4]=e("span",null,"/",-1)),e("span",be,a(P.value||"Détail"),1)]),e("h1",xe,a(P.value),1),e("p",pe,[t[6]||(t[6]=v(" Matricule : ",-1)),e("b",null,a(m.value?.matricule||"—"),1),i.value?(o(),r(p,{key:0},[t[5]||(t[5]=v(" · Classe : ",-1)),j(y(w),{to:`/classes/detail?id=${i.value.id}`,class:"font-medium text-violet-700 hover:underline dark:text-violet-300"},{default:k(()=>[v(a(R.value),1)]),_:1},8,["to"])],64)):$("",!0)])]),e("div",fe,[e("button",{type:"button",class:"rounded-md border border-slate-200 bg-white px-3 py-2 text-sm hover:bg-slate-50 dark:border-slate-800 dark:bg-slate-900",onClick:t[0]||(t[0]=l=>s.window.print())}," Imprimer "),b.value?(o(),ee(y(w),{key:0,to:`/bulletins/detail?eleveId=${c.value}&periodeId=${b.value.id}`,class:"rounded-md border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white hover:bg-violet-700 dark:border-violet-900"},{default:k(()=>[v(" Voir bulletin ("+a(b.value.label)+") ",1)]),_:1},8,["to"])):$("",!0)])]),e("div",he,[e("div",_e,[t[7]||(t[7]=e("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"Moyenne générale",-1)),e("div",ke,a(K.value??"—"),1)]),e("div",ye,[t[8]||(t[8]=e("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"Évaluations (période)",-1)),e("div",ge,a(x.value.length),1)]),e("div",we,[t[9]||(t[9]=e("div",{class:"text-xs text-slate-500 dark:text-slate-400"},"Rang (bulletin)",-1)),e("div",Ne,a(Q.value??"—"),1)])]),e("div",Ie,[G(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),class:"w-full max-w-xs rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[(o(!0),r(p,null,g(f.value,l=>(o(),r("option",{key:l.id,value:l.id},a(l.label),9,Me))),128))],512),[[te,u.value,void 0,{number:!0}]]),t[10]||(t[10]=e("span",{class:"text-xs text-slate-500 dark:text-slate-400"},"Filtre la moyenne et la liste des évaluations.",-1))]),e("div",Ce,[e("div",Se," Moyennes par matière ("+a(F(u.value))+") ",1),Object.keys(q.value).length===0?(o(),r("div",$e," Aucune évaluation pour cette période. ")):(o(),r("div",je,[e("table",Ee,[t[11]||(t[11]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Matière"),e("th",{class:"px-4 py-3 font-medium"},"Moyenne"),e("th",{class:"px-4 py-3 font-medium"},"Évals")])],-1)),e("tbody",null,[(o(!0),r(p,null,g(q.value,(l,n)=>(o(),r("tr",{key:n,class:"border-t border-slate-100 dark:border-slate-800"},[e("td",Be,a(n),1),e("td",Oe,a(l.moy),1),e("td",Ve,a(l.count),1)]))),128))])])]))]),e("div",Le,[e("div",De,[e("div",Pe,"Évaluations ("+a(x.value.length)+")",1),G(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>S.value=l),type:"search",placeholder:"Filtrer (matière, type, obs)…",class:"w-64 max-w-full rounded-md border border-slate-200 bg-white px-3 py-1.5 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,512),[[se,S.value]])]),x.value.length===0?(o(),r("div",Re," Aucune évaluation pour cette période. ")):(o(),r("div",Ae,[e("table",Fe,[t[12]||(t[12]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Matière"),e("th",{class:"px-4 py-3 font-medium"},"Type"),e("th",{class:"px-4 py-3 font-medium"},"Coef"),e("th",{class:"px-4 py-3 font-medium"},"Note"),e("th",{class:"px-4 py-3 font-medium"},"Obs.")])],-1)),e("tbody",null,[(o(!0),r(p,null,g(X.value,l=>(o(),r("tr",{key:l.id,class:"border-t border-slate-100 dark:border-slate-800"},[e("td",Te,a(l._matiere),1),e("td",qe,a(l.type),1),e("td",Ue,a(l.coef),1),e("td",Ge,a(l.note),1),e("td",Je,a(l.obs||"—"),1)]))),128))])])]))]),e("div",We,[e("div",ze," Cours (classe "+a(R.value||"—")+") ",1),A.value.length===0?(o(),r("div",He,"Aucun cours.")):(o(),r("ul",Ke,[(o(!0),r(p,null,g(A.value,l=>(o(),r("li",{key:l.id,class:"flex items-center justify-between px-4 py-3 text-sm"},[e("div",Qe,[e("div",Xe,a(l.matiere)+" — "+a(l.intitule||l.code),1),e("div",Ye," Prof : "+a(H(l.teacherId))+" · "+a(F(l.periodeId)),1)]),j(y(w),{to:`/cours/detail?id=${l.id}`,class:"shrink-0 rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:k(()=>[...t[13]||(t[13]=[v("Détails",-1)])]),_:1},8,["to"])]))),128))]))]),!D.value&&!m.value?(o(),r("div",Ze," Élève introuvable. ")):$("",!0)]))}};export{nt as default};
