import{P as G,Q as H,a as i,o as n,b as e,F as m,h as b,t as r,k as v,d as I,e as T,f as E,g as A,p as Q,c,m as g}from"./index-DNOX9g9Q.js";import{u as J}from"./useCours-CvA8_x3u.js";import{u as K}from"./useClasses-DkAspZBe.js";import{u as W}from"./usePeriodes-CobyAUWM.js";import{u as X}from"./useTeachers-CqgeM82D.js";const Y=G("examens"),Z=H("examens",Y),ee={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-6"},se=["value"],te=["value"],oe=["value"],ae=["value"],le=["value"],re=["value"],de=["value"],ie=["value"],ne=["value"],ue=["value"],pe=["value"],ce={__name:"ExamensFilters",props:{search:String,classeId:String,coursId:String,periodeId:String,type:String,session:String,classesOptions:{type:Array,default:()=>[]},coursOptions:{type:Array,default:()=>[]},periodesOptions:{type:Array,default:()=>[]},typesOptions:{type:Array,default:()=>[]},sessionsOptions:{type:Array,default:()=>[]}},emits:["update:search","update:classeId","update:coursId","update:periodeId","update:type","update:session"],setup(p){return(u,o)=>(n(),i("div",ee,[e("input",{value:p.search,onInput:o[0]||(o[0]=s=>u.$emit("update:search",s.target.value)),type:"search",placeholder:"Rechercher (titre, cours, classe, prof)…",class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},null,40,se),e("select",{value:p.classeId,onChange:o[1]||(o[1]=s=>u.$emit("update:classeId",s.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[6]||(o[6]=e("option",{value:""},"Toutes classes",-1)),(n(!0),i(m,null,b(p.classesOptions,s=>(n(),i("option",{key:s.value,value:s.value},r(s.label),9,oe))),128))],40,te),e("select",{value:p.coursId,onChange:o[2]||(o[2]=s=>u.$emit("update:coursId",s.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[7]||(o[7]=e("option",{value:""},"Tous cours",-1)),(n(!0),i(m,null,b(p.coursOptions,s=>(n(),i("option",{key:s.value,value:s.value},r(s.label),9,le))),128))],40,ae),e("select",{value:p.periodeId,onChange:o[3]||(o[3]=s=>u.$emit("update:periodeId",s.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[8]||(o[8]=e("option",{value:""},"Toutes périodes",-1)),(n(!0),i(m,null,b(p.periodesOptions,s=>(n(),i("option",{key:s.value,value:s.value},r(s.label),9,de))),128))],40,re),e("select",{value:p.type,onChange:o[4]||(o[4]=s=>u.$emit("update:type",s.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[9]||(o[9]=e("option",{value:""},"Tous types",-1)),(n(!0),i(m,null,b(p.typesOptions,s=>(n(),i("option",{key:s.value,value:s.value},r(s.label),9,ne))),128))],40,ie),e("select",{value:p.session,onChange:o[5]||(o[5]=s=>u.$emit("update:session",s.target.value)),class:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm focus:border-violet-500 focus:ring-1 focus:ring-violet-500 dark:border-slate-800 dark:bg-slate-900 dark:text-slate-100"},[o[10]||(o[10]=e("option",{value:""},"Toutes sessions",-1)),(n(!0),i(m,null,b(p.sessionsOptions,s=>(n(),i("option",{key:s.value,value:s.value},r(s.label),9,pe))),128))],40,ue)]))}},ve={class:"block md:hidden divide-y divide-slate-100 dark:divide-slate-800"},me={class:"flex items-start justify-between gap-3"},be={class:"min-w-0"},fe={class:"font-semibold"},ge={class:"text-xs text-slate-500 dark:text-slate-400"},xe=["onClick"],ye={class:"mt-2 grid grid-cols-2 gap-2 text-xs text-slate-600 dark:text-slate-300"},he={class:"col-span-2"},ke={class:"col-span-2"},$e={class:"hidden min-w-full text-left text-sm md:table"},we={class:"px-4 py-3"},_e={class:"px-4 py-3"},Ie={class:"px-4 py-3"},Se={class:"px-4 py-3"},Ce={class:"px-4 py-3"},Le={class:"px-4 py-3"},Oe={class:"px-4 py-3"},Be={class:"px-4 py-3"},Te={class:"px-4 py-3"},Ee={class:"flex justify-end gap-2"},Ae=["onClick"],je={class:"flex items-center justify-between border-t border-slate-100 px-4 py-3 text-sm dark:border-slate-800"},De={class:"text-slate-500 dark:text-slate-400"},Pe={__name:"ExamensTable",props:{items:{type:Array,default:()=>[]},total:{type:Number,default:0}},emits:["remove"],setup(p){function u(o){if(!o)return"—";try{return new Date(o).toLocaleDateString()}catch{return o}}return(o,s)=>(n(),i(m,null,[e("div",ve,[(n(!0),i(m,null,b(p.items,l=>(n(),i("div",{key:l.id,class:"p-4"},[e("div",me,[e("div",be,[e("div",fe,r(l.titre),1),e("div",ge,r(l._coursLabel)+" • "+r(l._classeLabel),1)]),e("button",{class:"shrink-0 rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:f=>o.$emit("remove",l.id)},"Supprimer",8,xe)]),e("div",ye,[e("div",null,[s[0]||(s[0]=e("span",{class:"opacity-60"},"Type:",-1)),v(" "+r(l.type||"—"),1)]),e("div",null,[s[1]||(s[1]=e("span",{class:"opacity-60"},"Session:",-1)),v(" "+r(l.session||"—"),1)]),e("div",null,[s[2]||(s[2]=e("span",{class:"opacity-60"},"Date:",-1)),v(" "+r(u(l.date)),1)]),e("div",null,[s[3]||(s[3]=e("span",{class:"opacity-60"},"Barème:",-1)),v(" "+r(l.bareme??20),1)]),e("div",he,[s[4]||(s[4]=e("span",{class:"opacity-60"},"Période:",-1)),v(" "+r(l._periodeLabel),1)]),e("div",ke,[s[5]||(s[5]=e("span",{class:"opacity-60"},"Prof:",-1)),v(" "+r(l._profLabel),1)])])]))),128))]),e("table",$e,[s[7]||(s[7]=e("thead",{class:"bg-slate-50 text-slate-600 dark:bg-slate-800 dark:text-slate-300"},[e("tr",null,[e("th",{class:"px-4 py-3 font-medium"},"Titre"),e("th",{class:"px-4 py-3 font-medium"},"Type"),e("th",{class:"px-4 py-3 font-medium"},"Session"),e("th",{class:"px-4 py-3 font-medium"},"Cours"),e("th",{class:"px-4 py-3 font-medium"},"Classe"),e("th",{class:"px-4 py-3 font-medium"},"Période"),e("th",{class:"px-4 py-3 font-medium"},"Date"),e("th",{class:"px-4 py-3 font-medium"},"Barème"),e("th",{class:"px-4 py-3 font-medium text-right"},"Actions")])],-1)),e("tbody",null,[(n(!0),i(m,null,b(p.items,l=>(n(),i("tr",{key:l.id,class:"border-t border-slate-100 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/60"},[e("td",we,r(l.titre),1),e("td",_e,r(l.type||"—"),1),e("td",Ie,r(l.session||"—"),1),e("td",Se,r(l._coursLabel),1),e("td",Ce,r(l._classeLabel),1),e("td",Le,r(l._periodeLabel),1),e("td",Oe,r(u(l.date)),1),e("td",Be,r(l.bareme??20),1),e("td",Te,[e("div",Ee,[I(E(A),{to:`/examens/detail?id=${l.id}`,class:"rounded-lg border border-slate-200 px-2 py-1 text-xs hover:bg-slate-100 dark:border-slate-700 dark:hover:bg-slate-800"},{default:T(()=>[...s[6]||(s[6]=[v(" Détails ",-1)])]),_:1},8,["to"]),e("button",{class:"rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50 dark:border-red-900/40 dark:hover:bg-red-900/20",onClick:f=>o.$emit("remove",l.id)}," Supprimer ",8,Ae)])])]))),128))])]),e("div",je,[e("span",De,r(p.items.length)+" / "+r(p.total)+" éléments ",1)])],64))}},Ue={class:"space-y-6"},Ne={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Re={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900"},Ve={key:0,class:"p-6"},Fe={key:1,class:"p-6 text-sm text-red-600 dark:text-red-400"},Me={key:2,class:"p-6 text-sm text-slate-500 dark:text-slate-400"},qe={key:3,class:"overflow-x-auto"},Ke={__name:"ExamensList",setup(p){const u=Z(),o=J(),s=K(),l=W(),f=X();Q(async()=>{await Promise.all([s.fetch(),l.fetch(),f.fetch(),o.fetch({_sort:"code"}),u.fetch({_sort:"date",_order:"desc"})])});const S=c(()=>Object.fromEntries((o.items||[]).map(a=>[a.id,a]))),j=c(()=>Object.fromEntries((s.items||[]).map(a=>[a.id,a]))),D=c(()=>Object.fromEntries((l.items||[]).map(a=>[a.id,a]))),P=c(()=>Object.fromEntries((f.items||[]).map(a=>[a.id,a]))),C=g(""),x=g(""),y=g(""),h=g(""),k=g(""),$=g(""),U=c(()=>(s.items||[]).map(a=>({value:String(a.id),label:a.libelle||a.label||a.code}))),N=c(()=>(o.items||[]).map(a=>({value:String(a.id),label:`${a.code} • ${a.intitule}`}))),R=c(()=>(l.items||[]).map(a=>({value:String(a.id),label:a.label}))),V=c(()=>{const a=new Set((u.items||[]).map(t=>t.type).filter(Boolean));return Array.from(a).sort().map(t=>({value:t,label:t}))}),F=c(()=>{const a=new Set((u.items||[]).map(t=>t.session).filter(Boolean));return Array.from(a).sort().map(t=>({value:t,label:t}))}),L=c(()=>{const a=C.value.trim().toLowerCase();return(u.items||[]).map(t=>{const d=S.value[t.coursId],w=d?j.value[d.classeId]:null,B=D.value[d?.periodeId??null],_=d?P.value[d.teacherId]:null;return{...t,_coursLabel:d?`${d.code} • ${d.intitule}`:"—",_matiere:d?.matiere||"—",_classeLabel:w?w.libelle||w.label||w.code:"—",_periodeLabel:B?B.label:"—",_profLabel:_?_.nom||`${_.prenom??""} ${_.nom??""}`.trim():"—"}}).filter(t=>x.value&&String(S.value[t.coursId]?.classeId)!==x.value||y.value&&String(t.coursId)!==y.value||h.value&&String(S.value[t.coursId]?.periodeId)!==h.value||k.value&&t.type!==k.value||$.value&&t.session!==$.value?!1:a?`${t.titre} ${t.type} ${t.session} ${t._coursLabel} ${t._matiere} ${t._classeLabel} ${t._profLabel} ${t._periodeLabel}`.toLowerCase().includes(a):!0)}),M=c(()=>u.items?.length||0),q=c(()=>u.loading||o.loading||s.loading||l.loading||f.loading),O=c(()=>u.error||o.error||s.error||l.error||f.error);async function z(a){confirm("Supprimer cet examen ?")&&(await u.removeOne(a),await u.fetch({_sort:"date",_order:"desc"}))}return(a,t)=>(n(),i("div",Ue,[e("div",Ne,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-xl font-semibold"},"Examens"),e("p",{class:"text-sm text-slate-500 dark:text-slate-400"}," Gestion des examens par cours / classe / période ")],-1)),I(E(A),{to:"/examens/nouveau",class:"inline-flex items-center gap-2 rounded-lg border border-violet-200 bg-violet-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-violet-700 dark:border-violet-900"},{default:T(()=>[...t[6]||(t[6]=[e("svg",{class:"h-4 w-4",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"})],-1),v(" Nouvel examen ",-1)])]),_:1})]),I(ce,{search:C.value,"onUpdate:search":t[0]||(t[0]=d=>C.value=d),classeId:x.value,"onUpdate:classeId":t[1]||(t[1]=d=>x.value=d),coursId:y.value,"onUpdate:coursId":t[2]||(t[2]=d=>y.value=d),periodeId:h.value,"onUpdate:periodeId":t[3]||(t[3]=d=>h.value=d),type:k.value,"onUpdate:type":t[4]||(t[4]=d=>k.value=d),session:$.value,"onUpdate:session":t[5]||(t[5]=d=>$.value=d),"classes-options":U.value,"cours-options":N.value,"periodes-options":R.value,"types-options":V.value,"sessions-options":F.value},null,8,["search","classeId","coursId","periodeId","type","session","classes-options","cours-options","periodes-options","types-options","sessions-options"]),e("div",Re,[q.value?(n(),i("div",Ve,[...t[8]||(t[8]=[e("div",{class:"h-4 w-1/3 animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-3"},null,-1),e("div",{class:"h-4 w-full animate-pulse rounded bg-slate-200 dark:bg-slate-800 mb-2"},null,-1),e("div",{class:"h-4 w-5/6 animate-pulse rounded bg-slate-200 dark:bg-slate-800"},null,-1)])])):O.value?(n(),i("div",Fe,r(O.value),1)):L.value.length===0?(n(),i("div",Me," Aucun examen trouvé. ")):(n(),i("div",qe,[I(Pe,{items:L.value,total:M.value,onRemove:z},null,8,["items","total"])]))])]))}};export{Ke as default};
